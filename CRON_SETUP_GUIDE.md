# üïê –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

## –ü—Ä–æ–±–ª–µ–º–∞

–°–∏—Å—Ç–µ–º–∞ –Ω–µ –æ–±–Ω–æ–≤–ª—è–ª–∞ –¥–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –ø–æ—Ç–æ–º—É —á—Ç–æ:
1. ‚ùå Cron –±—ã–ª –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ **1 —Ä–∞–∑ –≤ –¥–µ–Ω—å** –≤–º–µ—Å—Ç–æ –∫–∞–∂–¥—ã—Ö 2 —á–∞—Å–æ–≤
2. ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª Cron –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤ (–æ—Å—Ç–∞—Ç–∫–∏, —Ü–µ–Ω—ã)
3. ‚ùå –§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ –±—ã–ª–∏ **–≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–µ–Ω—ã**

## –†–µ—à–µ–Ω–∏–µ

### 1. ‚úÖ –í–∫–ª—é—á–µ–Ω—ã —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏

**–§–∞–π–ª:** `lib/startup/initBackgroundTasks.ts`

–£–¥–∞–ª–µ–Ω–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ:
```typescript
// –ë–´–õ–û:
// –í–†–ï–ú–ï–ù–ù–û –û–¢–ö–õ–Æ–ß–ï–ù–û –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –ë–î
console.log('‚ö†Ô∏è [Startup] –§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–µ–Ω—ã');
return;

// –°–¢–ê–õ–û:
// –§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ —Ä–∞–±–æ—Ç–∞—é—Ç ‚úÖ
```

### 2. ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω Vercel Cron

**–§–∞–π–ª:** `vercel.json`

–î–æ–±–∞–≤–ª–µ–Ω—ã 3 Cron –∑–∞–¥–∞—á–∏:

```json
{
  "crons": [
    {
      "path": "/api/cron/sync-analytics",
      "schedule": "0 */2 * * *"  // –ö–∞–∂–¥—ã–µ 2 —á–∞—Å–∞
    },
    {
      "path": "/api/cron/check-prices",
      "schedule": "*/30 * * * *"  // –ö–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç
    },
    {
      "path": "/api/cron/sync-products",
      "schedule": "0 */2 * * *"  // –ö–∞–∂–¥—ã–µ 2 —á–∞—Å–∞
    }
  ]
}
```

### 3. ‚úÖ –°–æ–∑–¥–∞–Ω Cron –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤

**–§–∞–π–ª:** `src/app/api/cron/sync-products/route.ts`

**–ß—Ç–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç:**
- üí∞ –¶–µ–Ω—ã —Ç–æ–≤–∞—Ä–æ–≤ (price, discountPrice)
- üì¶ –û—Å—Ç–∞—Ç–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ (stock)
- üìä –°—Ç–∞—Ç—É—Å –ø—É–±–ª–∏–∫–∞—Ü–∏–∏

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. –ü–æ–ª—É—á–∞–µ—Ç –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–∞–±–∏–Ω–µ—Ç—ã
2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞ –ø–æ–ª—É—á–∞–µ—Ç –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã
3. –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞:
   - –ü–æ–ª—É—á–∞–µ—Ç —Ç–µ–∫—É—â—É—é —Ü–µ–Ω—É —Å WB API
   - –ü–æ–ª—É—á–∞–µ—Ç —Ç–µ–∫—É—â–∏–µ –æ—Å—Ç–∞—Ç–∫–∏ —Å WB API
   - –û–±–Ω–æ–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ –ë–î –µ—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å
4. –ó–∞–¥–µ—Ä–∂–∫–∞ 1.5 —Å–µ–∫—É–Ω–¥—ã –º–µ–∂–¥—É —Ç–æ–≤–∞—Ä–∞–º–∏ (rate limiting)
5. –ó–∞–¥–µ—Ä–∂–∫–∞ 2 —Å–µ–∫—É–Ω–¥—ã –º–µ–∂–¥—É –∫–∞–±–∏–Ω–µ—Ç–∞–º–∏

## –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ Cron –∑–∞–¥–∞—á

| –ó–∞–¥–∞—á–∞ | –ß–∞—Å—Ç–æ—Ç–∞ | –ß—Ç–æ –¥–µ–ª–∞–µ—Ç |
|--------|---------|------------|
| **sync-analytics** | –ö–∞–∂–¥—ã–µ 2 —á–∞—Å–∞ | –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç –∞–Ω–∞–ª–∏—Ç–∏–∫—É (–ø—Ä–æ—Å–º–æ—Ç—Ä—ã, –≤ –∫–æ—Ä–∑–∏–Ω—É, –∑–∞–∫–∞–∑—ã, CTR, –∫–æ–Ω–≤–µ—Ä—Å–∏—è) |
| **check-prices** | –ö–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã–µ —Ü–µ–Ω—ã |
| **sync-products** | –ö–∞–∂–¥—ã–µ 2 —á–∞—Å–∞ | –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç —Ü–µ–Ω—ã, –æ—Å—Ç–∞—Ç–∫–∏, —Å—Ç–∞—Ç—É—Å —Ç–æ–≤–∞—Ä–æ–≤ |

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ Vercel

### –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ CRON_SECRET

–í Vercel Dashboard ‚Üí Settings ‚Üí Environment Variables:

```
CRON_SECRET=your-secret-key-here
```

**–í–∞–∂–Ω–æ:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ª–æ–∂–Ω—ã–π —Å–ª—É—á–∞–π–Ω—ã–π –∫–ª—é—á –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏!

### –®–∞–≥ 2: –î–µ–ø–ª–æ–π –∏–∑–º–µ–Ω–µ–Ω–∏–π

```bash
git add .
git commit -m "feat: –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π cron –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö"
git push
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Cron –≤ Vercel

1. –û—Ç–∫—Ä–æ–π—Ç–µ Vercel Dashboard
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª **Cron Jobs**
3. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤—Å–µ 3 –∑–∞–¥–∞—á–∏ –∞–∫—Ç–∏–≤–Ω—ã:
   - ‚úÖ `/api/cron/sync-analytics` - –∫–∞–∂–¥—ã–µ 2 —á–∞—Å–∞
   - ‚úÖ `/api/cron/check-prices` - –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç
   - ‚úÖ `/api/cron/sync-products` - –∫–∞–∂–¥—ã–µ 2 —á–∞—Å–∞

## –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

–í—ã –º–æ–∂–µ—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å Cron –∑–∞–¥–∞—á–∏ –≤—Ä—É—á–Ω—É—é:

### –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
```bash
curl -X POST https://neals.vercel.app/api/cron/sync-analytics \
  -H "Authorization: Bearer YOUR_CRON_SECRET"
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–Ω
```bash
curl -X GET https://neals.vercel.app/api/cron/check-prices \
  -H "Authorization: Bearer YOUR_CRON_SECRET"
```

### –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ç–æ–≤–∞—Ä–æ–≤
```bash
curl -X POST https://neals.vercel.app/api/cron/sync-products \
  -H "Authorization: Bearer YOUR_CRON_SECRET"
```

## –õ–æ–≥–∏

### –£—Å–ø–µ—à–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ç–æ–≤–∞—Ä–æ–≤:
```
üïê [Sync Products Cron] –ó–∞–ø—É—Å–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤
üìä [Sync Products Cron] –ù–∞–π–¥–µ–Ω–æ 1 –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–∞–±–∏–Ω–µ—Ç–æ–≤
üîÑ [Sync Products Cron] –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–∞–±–∏–Ω–µ—Ç–∞: BASEE
üì¶ [Sync Products Cron] –ö–∞–±–∏–Ω–µ—Ç BASEE: —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è 52 —Ç–æ–≤–∞—Ä–æ–≤
üí∞ [Sync Products Cron] –¢–æ–≤–∞—Ä –°–º–∞—Ä—Ç-—á–∞—Å—ã: —Ü–µ–Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞ 4562‚ÇΩ ‚Üí 4600‚ÇΩ
üì¶ [Sync Products Cron] –¢–æ–≤–∞—Ä –ù–∞—É—à–Ω–∏–∫–∏: –æ—Å—Ç–∞—Ç–æ–∫ –æ–±–Ω–æ–≤–ª–µ–Ω 10 ‚Üí 8
‚úÖ [Sync Products Cron] –ö–∞–±–∏–Ω–µ—Ç BASEE: —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ 2, –æ—à–∏–±–æ–∫ 0
‚úÖ [Sync Products Cron] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞: 2 —É—Å–ø–µ—à–Ω–æ, 0 –æ—à–∏–±–æ–∫
```

### –£—Å–ø–µ—à–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏:
```
üïê –ó–∞–ø—É—Å–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
üìä –ù–∞–π–¥–µ–Ω–æ 1 –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–∞–±–∏–Ω–µ—Ç–æ–≤
üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–∞–±–∏–Ω–µ—Ç–∞: BASEE
üì¶ –ö–∞–±–∏–Ω–µ—Ç BASEE: —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è 52 —Ç–æ–≤–∞—Ä–æ–≤
‚úÖ –ö–∞–±–∏–Ω–µ—Ç BASEE: —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ 52, –æ—à–∏–±–æ–∫ 0
‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞: 52 —É—Å–ø–µ—à–Ω–æ, 0 –æ—à–∏–±–æ–∫
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:

**–í –ë–î (ProductAnalytics):**
```sql
SELECT 
  nmId,
  views,
  addToCart,
  orders,
  lastSyncAt
FROM product_analytics
ORDER BY lastSyncAt DESC
LIMIT 10;
```

**–í –ª–æ–≥–∞—Ö Vercel:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ Vercel Dashboard
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª **Logs**
3. –§–∏–ª—å—Ç—Ä: `[Sync Products Cron]` –∏–ª–∏ `[Sync Analytics Cron]`

## –ß–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã

### Q: –ü–æ—á–µ–º—É –¥–∞–Ω–Ω—ã–µ –Ω–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è?

**A:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. ‚úÖ CRON_SECRET —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ Vercel
2. ‚úÖ Cron –∑–∞–¥–∞—á–∏ –∞–∫—Ç–∏–≤–Ω—ã –≤ Vercel Dashboard
3. ‚úÖ –ö–∞–±–∏–Ω–µ—Ç—ã –∞–∫—Ç–∏–≤–Ω—ã –∏ –∏–º–µ—é—Ç –≤–∞–ª–∏–¥–Ω—ã–µ API —Ç–æ–∫–µ–Ω—ã
4. ‚úÖ –¢–æ–≤–∞—Ä—ã –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω—ã (status = 'PUBLISHED')
5. ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö Vercel

### Q: –ö–∞–∫ —á–∞—Å—Ç–æ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ?

**A:**
- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞: –∫–∞–∂–¥—ã–µ 2 —á–∞—Å–∞
- –¶–µ–Ω—ã –∏ –æ—Å—Ç–∞—Ç–∫–∏: –∫–∞–∂–¥—ã–µ 2 —á–∞—Å–∞
- –ó–∞–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã–µ —Ü–µ–Ω—ã: –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç

### Q: –ú–æ–∂–Ω–æ –ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å —á–∞—Å—Ç–æ—Ç—É?

**A:** –î–∞, –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `vercel.json`:
```json
"schedule": "0 */1 * * *"  // –ö–∞–∂–¥—ã–π —á–∞—Å
"schedule": "*/15 * * * *"  // –ö–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç
```

**–í–Ω–∏–º–∞–Ω–∏–µ:** –°–ª–∏—à–∫–æ–º —á–∞—Å—Ç—ã–µ –∑–∞–ø—Ä–æ—Å—ã –º–æ–≥—É—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ rate limiting –æ—Ç WB API!

### Q: –ö–∞–∫ –æ—Ç–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ?

**A:** –£–¥–∞–ª–∏—Ç–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –∑–∞–¥–∞—á—É –∏–∑ `vercel.json` –∏ —Å–¥–µ–ª–∞–π—Ç–µ –¥–µ–ø–ª–æ–π.

## –†–µ–∑—É–ª—å—Ç–∞—Ç

‚úÖ –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –∫–∞–∂–¥—ã–µ 2 —á–∞—Å–∞
‚úÖ –ó–∞–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã–µ —Ü–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç
‚úÖ –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è —Å WB API
‚úÖ Graceful degradation –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
‚úÖ –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

## –§–∞–π–ª—ã

- `vercel.json` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Cron
- `lib/startup/initBackgroundTasks.ts` - –≤–∫–ª—é—á–µ–Ω—ã —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏
- `src/app/api/cron/sync-analytics/route.ts` - —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
- `src/app/api/cron/check-prices/route.ts` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–Ω
- `src/app/api/cron/sync-products/route.ts` - —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ç–æ–≤–∞—Ä–æ–≤ (–ù–û–í–´–ô)
