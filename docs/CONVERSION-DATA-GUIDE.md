# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–µ–∞–ª—å–Ω—ã–º –¥–∞–Ω–Ω—ã–º –∫–æ–Ω–≤–µ—Ä—Å–∏–∏

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **—Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏** –∏–∑ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã `ProductAnalytics` –≤–º–µ—Å—Ç–æ –ø–æ–ø—ã—Ç–æ–∫ –ø–æ–ª—É—á–∏—Ç—å –∏—Ö –Ω–∞–ø—Ä—è–º—É—é –∏–∑ WB Analytics API.

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 1. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

–î–∞–Ω–Ω—ã–µ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è –∫–∞–∂–¥—ã–π —á–∞—Å —á–µ—Ä–µ–∑ Cron Job:

```
Cron Job (/api/cron/sync-analytics)
  ‚Üì
–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å WB API
  ‚Üì
–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ —Ç–∞–±–ª–∏—Ü—É ProductAnalytics
  ‚Üì
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ Dashboard
```

### 2. –ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö

**–¢–∞–±–ª–∏—Ü–∞:** `product_analytics`

**–ü–æ–ª—è –∫–æ–Ω–≤–µ—Ä—Å–∏–∏:**
- `views` - –ø—Ä–æ—Å–º–æ—Ç—Ä—ã –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–∞
- `addToCart` - –¥–æ–±–∞–≤–ª–µ–Ω–∏–π –≤ –∫–æ—Ä–∑–∏–Ω—É
- `orders` - –∑–∞–∫–∞–∑—ã
- `ctr` - CTR (Click-Through Rate) –≤ %
- `conversionRate` - –∫–æ–Ω–≤–µ—Ä—Å–∏—è –∫–æ—Ä–∑–∏–Ω–∞ ‚Üí –∑–∞–∫–∞–∑ –≤ %

### 3. –õ–æ–≥–∏–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

```typescript
// 1. –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ nmId –∏–∑ –ø—Ä–æ–¥–∞–∂
const uniqueNmIds = Array.from(new Set(salesData.map(sale => sale.nmId)));

// 2. –ó–∞–≥—Ä—É–∂–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –ë–î
const analyticsData = await prisma.productAnalytics.findMany({
  where: {
    nmId: { in: uniqueNmIds.map(String) },
    syncStatus: 'success' // –¢–æ–ª—å–∫–æ —É—Å–ø–µ—à–Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ
  }
});

// 3. –ê–≥—Ä–µ–≥–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ
analyticsData.forEach(analytics => {
  totalViews += analytics.views;
  addToCart += analytics.addToCart;
  totalOrders += analytics.orders;
  totalCTR += analytics.ctr;
  totalConversionRate += analytics.conversionRate;
});

// 4. –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ä–µ–¥–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è
const avgCTR = productsWithData > 0 ? totalCTR / productsWithData : 0;
const addToCartRate = totalViews > 0 ? (addToCart / totalViews) * 100 : avgCTR;
const purchaseRate = addToCart > 0 ? (totalOrders / addToCart) * 100 : avgConversionRate;
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞

### ‚úÖ –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å
- –ù–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ WB Analytics API –≤ –º–æ–º–µ–Ω—Ç –∑–∞–ø—Ä–æ—Å–∞
- –î–∞–Ω–Ω—ã–µ —É–∂–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
- –ù–µ—Ç –∑–∞–¥–µ—Ä–∂–µ–∫ –Ω–∞ –∑–∞–ø—Ä–æ—Å—ã –∫ –≤–Ω–µ—à–Ω–µ–º—É API

### ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –ë—ã—Å—Ç—Ä–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î
- –ù–µ—Ç rate limits –æ—Ç WB API
- –ú–µ–Ω—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ WB —Å–µ—Ä–≤–µ—Ä—ã

### ‚úÖ –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å
- –í—Å–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –æ–¥–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ä–µ–≥—É–ª—è—Ä–Ω–æ (–∫–∞–∂–¥—ã–π —á–∞—Å)
- –û–¥–∏–Ω–∞–∫–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è –≤—Å–µ—Ö —Ç–æ–≤–∞—Ä–æ–≤

## –õ–æ–≥–∏ —Å–∏—Å—Ç–µ–º—ã

### –° —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

```
üìä –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –æ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ –∏–∑ –ë–î (ProductAnalytics)...
üì¶ –ù–∞–π–¥–µ–Ω–æ 77 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏
‚úÖ –ù–∞–π–¥–µ–Ω–æ 52 —Ç–æ–≤–∞—Ä–æ–≤ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
  üìä –ü–ª–∞—Ç—å–µ —Å —Ö–∏–º–∞—Ä–æ–º –¥–ª—è –£–º—Ä—ã –∏...: 1250 –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤, CTR 8.5%, –∫–æ–Ω–≤–µ—Ä—Å–∏—è 15.2%
  üìä BOROFONE —à–µ–π–Ω—ã–µ –±–µ—Å–ø—Ä–æ–≤–æ–¥–Ω—ã–µ...: 890 –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤, CTR 12.3%, –∫–æ–Ω–≤–µ—Ä—Å–∏—è 22.1%
  üìä –ú—É—Å—É–ª—å–º–∞–Ω—Å–∫–æ–µ –ø–ª–∞—Ç—å–µ. –ù–∞–º–∞–∑–Ω...: 2100 –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤, CTR 6.8%, –∫–æ–Ω–≤–µ—Ä—Å–∏—è 18.5%
  ...
‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º –†–ï–ê–õ–¨–ù–´–ï –¥–∞–Ω–Ω—ã–µ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ –∏–∑ –ë–î: {
  —Ç–æ–≤–∞—Ä–æ–≤–°–î–∞–Ω–Ω—ã–º–∏: 52,
  –ø—Ä–æ—Å–º–æ—Ç—Ä—ã: 45230,
  –≤–ö–æ—Ä–∑–∏–Ω—É: 4523,
  –∑–∞–∫–∞–∑–æ–≤: 905,
  CTR: '10.00%',
  –∫–æ–Ω–≤–µ—Ä—Å–∏—è–í–ö–æ—Ä–∑–∏–Ω—É: '10.00%',
  –∫–æ–Ω–≤–µ—Ä—Å–∏—è–í–ó–∞–∫–∞–∑: '20.00%'
}
```

### –ë–µ–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (fallback)

```
üìä –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –æ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ –∏–∑ –ë–î (ProductAnalytics)...
üì¶ –ù–∞–π–¥–µ–Ω–æ 77 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏
‚úÖ –ù–∞–π–¥–µ–Ω–æ 0 —Ç–æ–≤–∞—Ä–æ–≤ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
‚ö†Ô∏è –ù–µ—Ç —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∞–Ω–∞–ª–∏—Ç–∏–∫–∏, –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∏–º–µ—Ä–Ω—ã–µ —Ä–∞—Å—á–µ—Ç—ã
‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∏–º–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏: {
  –ø—Ä–æ—Å–º–æ—Ç—Ä—ã: 3850,
  –≤–ö–æ—Ä–∑–∏–Ω—É: 385,
  CTR: '10.00%',
  –∫–æ–Ω–≤–µ—Ä—Å–∏—è–í–ö–æ—Ä–∑–∏–Ω—É: '10.00%',
  –∫–æ–Ω–≤–µ—Ä—Å–∏—è–í–ó–∞–∫–∞–∑: '20.00%'
}
```

## –ú–µ—Ç—Ä–∏–∫–∏ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏

### CTR (Click-Through Rate)
**–§–æ—Ä–º—É–ª–∞:** `(–î–æ–±–∞–≤–ª–µ–Ω–∏–π –≤ –∫–æ—Ä–∑–∏–Ω—É / –ü—Ä–æ—Å–º–æ—Ç—Ä—ã) √ó 100%`

**–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è:**
- < 5% - –Ω–∏–∑–∫–∏–π CTR, –Ω—É–∂–Ω–æ —É–ª—É—á—à–∞—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É —Ç–æ–≤–∞—Ä–∞
- 5-10% - —Å—Ä–µ–¥–Ω–∏–π CTR
- > 10% - —Ö–æ—Ä–æ—à–∏–π CTR

### Conversion Rate (–ö–æ–Ω–≤–µ—Ä—Å–∏—è –∫–æ—Ä–∑–∏–Ω–∞ ‚Üí –∑–∞–∫–∞–∑)
**–§–æ—Ä–º—É–ª–∞:** `(–ó–∞–∫–∞–∑—ã / –î–æ–±–∞–≤–ª–µ–Ω–∏–π –≤ –∫–æ—Ä–∑–∏–Ω—É) √ó 100%`

**–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è:**
- < 15% - –Ω–∏–∑–∫–∞—è –∫–æ–Ω–≤–µ—Ä—Å–∏—è
- 15-25% - —Å—Ä–µ–¥–Ω—è—è –∫–æ–Ω–≤–µ—Ä—Å–∏—è
- > 25% - –≤—ã—Å–æ–∫–∞—è –∫–æ–Ω–≤–µ—Ä—Å–∏—è

### Cart Abandonment Rate (–ë—Ä–æ—à–µ–Ω–Ω—ã–µ –∫–æ—Ä–∑–∏–Ω—ã)
**–§–æ—Ä–º—É–ª–∞:** `((–î–æ–±–∞–≤–ª–µ–Ω–∏–π –≤ –∫–æ—Ä–∑–∏–Ω—É - –ó–∞–∫–∞–∑—ã) / –î–æ–±–∞–≤–ª–µ–Ω–∏–π –≤ –∫–æ—Ä–∑–∏–Ω—É) √ó 100%`

**–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è:**
- < 70% - –æ—Ç–ª–∏—á–Ω–æ
- 70-85% - –Ω–æ—Ä–º–∞–ª—å–Ω–æ
- > 85% - –º–Ω–æ–≥–æ –±—Ä–æ—à–µ–Ω–Ω—ã—Ö –∫–æ—Ä–∑–∏–Ω

## –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è (Cron)

–î–∞–Ω–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è –∫–∞–∂–¥—ã–π —á–∞—Å:

```json
// vercel.json
{
  "crons": [{
    "path": "/api/cron/sync-analytics",
    "schedule": "0 * * * *"
  }]
}
```

### –†—É—á–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

```bash
# –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö —Ç–æ–≤–∞—Ä–æ–≤
curl -X POST http://localhost:3000/api/analytics/sync \
  -H "Content-Type: application/json" \
  -d '{"forceSync": true}'

# –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
curl -X POST http://localhost:3000/api/analytics/sync \
  -H "Content-Type: application/json" \
  -d '{
    "productIds": ["product-id-1", "product-id-2"],
    "forceSync": true
  }'
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞

```bash
# –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
curl http://localhost:3000/api/analytics/sync

# –û—Ç–≤–µ—Ç:
{
  "success": true,
  "totalProducts": 77,
  "productsWithAnalytics": 52,
  "productsWithoutAnalytics": 25,
  "lastSync": "2025-10-23T13:00:00.000Z",
  "needsSync": false
}
```

## Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ—Ç —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∫–æ–Ω–≤–µ—Ä—Å–∏–∏

**–ü—Ä–∏—á–∏–Ω—ã:**
1. –¢–æ–≤–∞—Ä—ã –µ—â–µ –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã
2. –£ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–µ—Ç nmId
3. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å —Å –æ—à–∏–±–∫–æ–π

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
curl http://localhost:3000/api/analytics/sync

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é
curl -X POST http://localhost:3000/api/analytics/sync \
  -d '{"forceSync": true}'

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
# –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–ø–∏—Å–∏ —Ç–∏–ø–∞:
# ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω —Ç–æ–≤–∞—Ä {id} ({name})
```

### –ü—Ä–æ–±–ª–µ–º–∞: –î–∞–Ω–Ω—ã–µ —É—Å—Ç–∞—Ä–µ–ª–∏

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∫–µ—à–∞
curl -X POST http://localhost:3000/api/analytics/sync \
  -d '{"forceSync": true, "daysBack": 30}'
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –ø—Ä–∏–º–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

**–ü—Ä–∏—á–∏–Ω—ã:**
1. –¢–æ–≤–∞—Ä—ã –Ω–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω—ã –Ω–∞ WB
2. –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –≤ WB Analytics API
3. –¢–æ–≤–∞—Ä—ã –Ω–µ–¥–∞–≤–Ω–æ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω—ã (< 24 —á–∞—Å–æ–≤)

**–†–µ—à–µ–Ω–∏–µ:**
- –ü–æ–¥–æ–∂–¥–∞—Ç—å 24-48 —á–∞—Å–æ–≤ –ø–æ—Å–ª–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
- –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Ç–æ–≤–∞—Ä—ã –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω—ã –∏ –∞–∫—Ç–∏–≤–Ω—ã
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ WB Analytics API

## API Response

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –∫–æ–Ω–≤–µ—Ä—Å–∏–∏

```typescript
{
  conversion: {
    totalViews: 45230,           // –í—Å–µ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤
    addToCartRate: 10.0,         // CTR (%)
    purchaseRate: 20.0,          // –ö–æ–Ω–≤–µ—Ä—Å–∏—è –∫–æ—Ä–∑–∏–Ω–∞ ‚Üí –∑–∞–∫–∞–∑ (%)
    avgCTR: 10.0,                // –°—Ä–µ–¥–Ω–∏–π CTR (%)
    cartAbandonmentRate: 80.0    // –ë—Ä–æ—à–µ–Ω–Ω—ã–µ –∫–æ—Ä–∑–∏–Ω—ã (%)
  }
}
```

## –§–∞–π–ª—ã

- `src/app/api/analytics/dashboard/route.ts` - –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ –∏–∑ –ë–î
- `src/app/api/analytics/sync/route.ts` - —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
- `src/app/api/cron/sync-analytics/route.ts` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
- `lib/services/wbProductAnalyticsService.ts` - —Å–µ—Ä–≤–∏—Å –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Å WB API
- `prisma/schema.prisma` - –º–æ–¥–µ–ª—å ProductAnalytics

## –ú–∏–≥—Ä–∞—Ü–∏—è —Å WB Analytics API

### –°—Ç–∞—Ä—ã–π –ø–æ–¥—Ö–æ–¥ (–£–î–ê–õ–ï–ù)

```typescript
// ‚ùå –ü—Ä—è–º–æ–π –∑–∞–ø—Ä–æ—Å –∫ WB Analytics API –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ dashboard
const conversionService = new WbConversionService(apiToken);
const conversionData = await conversionService.getConversionWithFallback(...);
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
- –ú–µ–¥–ª–µ–Ω–Ω–æ (–∑–∞–ø—Ä–æ—Å—ã –∫ –≤–Ω–µ—à–Ω–µ–º—É API)
- –ù–µ–Ω–∞–¥–µ–∂–Ω–æ (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ WB API)
- Rate limits –æ—Ç WB

### –ù–æ–≤—ã–π –ø–æ–¥—Ö–æ–¥ (–¢–ï–ö–£–©–ò–ô)

```typescript
// ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–∑ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –ë–î
const analyticsData = await prisma.productAnalytics.findMany({
  where: {
    nmId: { in: uniqueNmIds.map(String) },
    syncStatus: 'success'
  }
});
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ë—ã—Å—Ç—Ä–æ (–ª–æ–∫–∞–ª—å–Ω–∞—è –ë–î)
- –ù–∞–¥–µ–∂–Ω–æ (–¥–∞–Ω–Ω—ã–µ –≤—Å–µ–≥–¥–∞ –¥–æ—Å—Ç—É–ø–Ω—ã)
- –ù–µ—Ç rate limits

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–†–µ–≥—É–ª—è—Ä–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è** - —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Cron Job —Ä–∞–±–æ—Ç–∞–µ—Ç
2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Å—Ç–∞—Ç—É—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ API
3. **Fallback** - —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–∏–º–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –µ—Å–ª–∏ –Ω–µ—Ç —Ä–µ–∞–ª—å–Ω—ã—Ö
4. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è** - –¥–∞–Ω–Ω—ã–µ –∫–µ—à–∏—Ä—É—é—Ç—Å—è –Ω–∞ 6 —á–∞—Å–æ–≤ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
