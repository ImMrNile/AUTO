# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –æ—Å—Ç–∞—Ç–∫–æ–≤

## –ò–∑–º–µ–Ω–µ–Ω–∏—è

### 1. –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ç–∏–ø–æ–≤ —Å–∫–ª–∞–¥–æ–≤
- **–§–ë–í ‚Üí FBW** (Fulfillment by Wildberries)
- **–§–ë–° ‚Üí FBS** (Fulfillment by Seller)

### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—Å—Ç–∞—Ç–∫–æ–≤

**–§–∞–π–ª:** `src/app/components/ProductsWithAnalytics.tsx`

- –û–±–Ω–æ–≤–ª–µ–Ω—ã –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∫–∞—Ä—Ç–æ—á–µ–∫ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (—Å—Ç—Ä–æ–∫–∏ 848, 859)
- –û–±–Ω–æ–≤–ª–µ–Ω—ã –∑–∞–≥–æ–ª–æ–≤–∫–∏ –≤ —Å–ø–∏—Å–∫–µ —Ç–æ–≤–∞—Ä–æ–≤ (—Å—Ç—Ä–æ–∫–∏ 1170, 1184)
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω —Ñ–∏–ª—å—Ç—Ä –¥–ª—è FBW: —Ç–µ–ø–µ—Ä—å —É—á–∏—Ç—ã–≤–∞–µ—Ç –∫–∞–∫ `FBW`, —Ç–∞–∫ –∏ `FBO` –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ (—Å—Ç—Ä–æ–∫–∏ 791, 1176)

### 3. API –¥–ª—è –æ—Å—Ç–∞—Ç–∫–æ–≤

**–§–∞–π–ª:** `src/app/api/wb/stocks/route.ts`

#### GET /api/wb/stocks
–ü–æ–ª—É—á–∞–µ—Ç –æ—Å—Ç–∞—Ç–∫–∏ —Å–æ –≤—Å–µ—Ö —Å–∫–ª–∞–¥–æ–≤ WB –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –ë–î:

```typescript
// –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ —Å–∫–ª–∞–¥–∞
warehouseType: warehouse.officeId ? 'FBS' : 'FBW'

// –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —Ç–∏–ø–∞–º
fbsStock: 0,  // FBS —Å–∫–ª–∞–¥—ã
fbwStock: 0   // FBW —Å–∫–ª–∞–¥—ã (—Ä–∞–Ω–µ–µ fboStock)
```

#### –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î
–ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Å—Ç–∞—Ç–∫–æ–≤ —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ç–∞–±–ª–∏—Ü—É `products`:

```typescript
await prisma.product.updateMany({
  where: {
    wbNmId: stockData.nmId.toString(),
    userId: user.id
  },
  data: {
    stock: stockData.totalStock,
    reserved: stockData.totalReserved,
    lastWbSyncAt: new Date(),
    wbSyncStatus: 'SUCCESS'
  }
});
```

### 4. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –æ—Å—Ç–∞—Ç–∫–æ–≤

```typescript
{
  nmId: number,
  vendorCode: string,
  warehouses: [
    {
      warehouseId: number,
      warehouseName: string,
      warehouseType: 'FBS' | 'FBW',
      stock: number,
      reserved: number
    }
  ],
  totalStock: number,
  totalReserved: number,
  fbsStock: number,
  fbwStock: number
}
```

## –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –ó–∞–≥—Ä—É–∑–∫–∞ –æ—Å—Ç–∞—Ç–∫–æ–≤
```typescript
const response = await fetch('/api/wb/stocks');
const data = await response.json();

// data.stocks - –º–∞—Å—Å–∏–≤ –æ—Å—Ç–∞—Ç–∫–æ–≤ –ø–æ —Ç–æ–≤–∞—Ä–∞–º
// data.warehouses - —Å–ø–∏—Å–æ–∫ —Å–∫–ª–∞–¥–æ–≤
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Å—Ç–∞—Ç–∫–æ–≤ FBS
```typescript
const response = await fetch('/api/wb/stocks', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    warehouseId: 123,
    sku: 'ABC123',
    amount: 50
  })
});
```

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –æ—Å—Ç–∞—Ç–∫–æ–≤ –≤ –∫–æ–Ω—Å–æ–ª–∏ —Å–µ—Ä–≤–µ—Ä–∞:
```
üì¶ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Å—Ç–∞—Ç–∫–æ–≤ –≤ –ë–î –¥–ª—è 110 —Ç–æ–≤–∞—Ä–æ–≤...
‚úÖ –û—Å—Ç–∞—Ç–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –ë–î
```

## –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

–°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞:
- `FBW` - –Ω–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ
- `FBO` - —Å—Ç–∞—Ä–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ (–¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)

–§–∏–ª—å—Ç—Ä—ã —É—á–∏—Ç—ã–≤–∞—é—Ç –æ–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞:
```typescript
w.warehouseType === 'FBW' || w.warehouseType === 'FBO'
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç

‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏–π —Å–∫–ª–∞–¥–æ–≤ (FBW, FBS)
‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø–æ–¥—Å—á–µ—Ç –æ—Å—Ç–∞—Ç–∫–æ–≤ –ø–æ —Ç–∏–ø–∞–º —Å–∫–ª–∞–¥–æ–≤
‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Å—Ç–∞—Ç–∫–æ–≤ –≤ –ë–î –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
‚úÖ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ —Å—Ç–∞—Ä—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
