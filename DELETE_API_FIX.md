# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: 405 Method Not Allowed –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ —É–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –æ—à–∏–±–∫–∞ **405 (Method Not Allowed)**:

```
Failed to load resource: the server responded with a status of 405 (Method Not Allowed)
‚ùå [InProgress] –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: SyntaxError: Unexpected end of JSON input
```

### –ü—Ä–∏—á–∏–Ω–∞

API endpoint `/api/products/[id]` **–Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–ª –º–µ—Ç–æ–¥ DELETE**. –í —Ñ–∞–π–ª–µ `route.ts` –±—ã–ª–∏ —Ç–æ–ª—å–∫–æ –º–µ—Ç–æ–¥—ã:
- ‚úÖ `GET` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
- ‚úÖ `PATCH` - —á–∞—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
- ‚úÖ `PUT` - –ø–æ–ª–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
- ‚ùå `DELETE` - **–æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª**

## –†–µ—à–µ–Ω–∏–µ

–î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `DELETE` –≤ —Ñ–∞–π–ª `src/app/api/products/[id]/route.ts`:

```typescript
// DELETE –º–µ—Ç–æ–¥ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞
export async function DELETE(
  request: NextRequest,
  { params }: { params: { id: string } }
) {
  try {
    console.log(`üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ ID: ${params.id}`);

    const user = await AuthService.getCurrentUser();
    if (!user) {
      return NextResponse.json({ 
        error: '–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω'
      }, { status: 401 });
    }

    // –£–¥–∞–ª—è–µ–º —Ç–æ–≤–∞—Ä (–∫–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –≤ schema.prisma)
    await safePrismaOperation(
      () => prisma.product.delete({
        where: { 
          id: params.id,
          userId: user.id // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏
        }
      }),
      '—É–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞'
    );

    console.log(`‚úÖ –¢–æ–≤–∞—Ä ${params.id} —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω`);

    return NextResponse.json({
      success: true,
      message: '–¢–æ–≤–∞—Ä —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω'
    });

  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞:', error);
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –Ω–∞–π–¥–µ–Ω –ª–∏ —Ç–æ–≤–∞—Ä
    if (error instanceof Error && error.message.includes('Record to delete does not exist')) {
      return NextResponse.json({
        success: false,
        error: '–¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ —É–∂–µ —É–¥–∞–ª–µ–Ω'
      }, { status: 404 });
    }
    
    return NextResponse.json({
      success: false,
      error: '–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞',
      details: error instanceof Error ? error.message : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'
    }, { status: 500 });
  }
}
```

## –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
```typescript
const user = await AuthService.getCurrentUser();
if (!user) {
  return NextResponse.json({ error: '–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω' }, { status: 401 });
}
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏
```typescript
where: { 
  id: params.id,
  userId: user.id // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —É–¥–∞–ª–∏—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–π —Ç–æ–≤–∞—Ä
}
```

### 3. –ö–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ
Prisma –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ—Ç —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:
- `ProductTask` - –∑–∞–¥–∞—á–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏
- `ProductCabinet` - —Å–≤—è–∑–∏ —Å –∫–∞–±–∏–Ω–µ—Ç–∞–º–∏
- `ProductBarcode` - —à—Ç—Ä–∏—Ö–∫–æ–¥—ã
- `ProductAnalytics` - –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
- –ò –¥—Ä—É–≥–∏–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏

### 4. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

| –û—à–∏–±–∫–∞ | –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|--------|----------|
| **–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω** | 401 | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∑–∞–ª–æ–≥–∏–Ω–µ–Ω |
| **–¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω** | 404 | –¢–æ–≤–∞—Ä –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏–ª–∏ —É–∂–µ —É–¥–∞–ª–µ–Ω |
| **–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞** | 404 | –¢–æ–≤–∞—Ä –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –¥—Ä—É–≥–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é |
| **–û—à–∏–±–∫–∞ –ë–î** | 500 | –ü—Ä–æ–±–ª–µ–º—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö |

## –õ–æ–≥–∏

### –£—Å–ø–µ—à–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ
```
üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ ID: cmhzrz9zp0003unswtsdxf9nb
‚úÖ –¢–æ–≤–∞—Ä cmhzrz9zp0003unswtsdxf9nb —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω
```

### –¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω
```
üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ ID: cmhzrz9zp0003unswtsdxf9nb
‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞: Record to delete does not exist
```

## API Response

### –£—Å–ø–µ—Ö (200)
```json
{
  "success": true,
  "message": "–¢–æ–≤–∞—Ä —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω"
}
```

### –ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω (401)
```json
{
  "error": "–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω"
}
```

### –¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω (404)
```json
{
  "success": false,
  "error": "–¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ —É–∂–µ —É–¥–∞–ª–µ–Ω"
}
```

### –û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ (500)
```json
{
  "success": false,
  "error": "–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞",
  "details": "..."
}
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### Frontend (React)
```typescript
const response = await fetch(`/api/products/${productId}`, {
  method: 'DELETE',
  credentials: 'include'
});

if (response.ok) {
  const data = await response.json();
  console.log(data.message); // "–¢–æ–≤–∞—Ä —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω"
  // –û–±–Ω–æ–≤–∏—Ç—å UI
} else {
  const error = await response.json();
  console.error(error.error);
}
```

### cURL
```bash
curl -X DELETE \
  http://localhost:3000/api/products/cmhzrz9zp0003unswtsdxf9nb \
  -H "Cookie: your-session-cookie"
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏** - —Ç–æ–ª—å–∫–æ –∑–∞–ª–æ–≥–∏–Ω–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏** - —Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü —Ç–æ–≤–∞—Ä–∞
‚úÖ **–ö–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
‚úÖ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
‚úÖ **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ HTTP —Å—Ç–∞—Ç—É—Å—ã

## –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã

**`src/app/api/products/[id]/route.ts`:**
- –°—Ç—Ä–æ–∫–∏ 358-408: –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `DELETE`

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ä–∞–∑–¥–µ–ª "–¢–æ–≤–∞—Ä—ã –≤ —Ä–∞–±–æ—Ç–µ"
2. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–£–¥–∞–ª–∏—Ç—å" –Ω–∞ –ª—é–±–æ–º —Ç–æ–≤–∞—Ä–µ
3. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ —É–¥–∞–ª–µ–Ω–∏–µ
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏:
   ```
   üóëÔ∏è [InProgress] –£–¥–∞–ª—è–µ–º —Ç–æ–≤–∞—Ä: cmhzrz9zp0003unswtsdxf9nb
   ‚úÖ [InProgress] –¢–æ–≤–∞—Ä —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω
   ‚úÖ [InProgress] –¢–æ–≤–∞—Ä —É–¥–∞–ª–µ–Ω –∏–∑ —Ä–∞–∑–¥–µ–ª–∞. –û—Å—Ç–∞–ª–æ—Å—å —Ç–æ–≤–∞—Ä–æ–≤: 1
   ```
5. –¢–æ–≤–∞—Ä –¥–æ–ª–∂–µ–Ω –∏—Å—á–µ–∑–Ω—É—Ç—å –∏–∑ —Å–ø–∏—Å–∫–∞

## –†–µ–∑—É–ª—å—Ç–∞—Ç

‚úÖ –û—à–∏–±–∫–∞ 405 –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞
‚úÖ –ú–µ—Ç–æ–¥ DELETE —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
‚úÖ –¢–æ–≤–∞—Ä—ã —É–¥–∞–ª—è—é—Ç—Å—è –∏–∑ –ë–î
‚úÖ UI –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
‚úÖ –í—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —É–¥–∞–ª—è—é—Ç—Å—è –∫–∞—Å–∫–∞–¥–Ω–æ
