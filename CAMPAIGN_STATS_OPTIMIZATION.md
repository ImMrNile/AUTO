# –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫–∞–º–ø–∞–Ω–∏–π

## –ü—Ä–æ–±–ª–µ–º–∞

**–î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–∞–º–ø–∞–Ω–∏–π –∑–∞–ø—Ä–∞—à–∏–≤–∞–ª–∞—Å—å **–¥–ª—è –∫–∞–∂–¥–æ–π –Ω–µ–¥–µ–ª–∏ –æ—Ç–¥–µ–ª—å–Ω–æ**
- –ü—Ä–∏ –ø–æ–∏—Å–∫–µ –¥–∞–Ω–Ω—ã—Ö –∑–∞ 60 –¥–Ω–µ–π = **~9 –∑–∞–ø—Ä–æ—Å–æ–≤** –∫ API
- –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –º–æ–≥ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –æ—à–∏–±–∫—É –∏–ª–∏ –¥—É–±–ª–∏–∫–∞—Ç—ã

**–ü—Ä–∏–º–µ—Ä:**
```
–ù–µ–¥–µ–ª—è 1: GET /adv/v3/fullstats?beginDate=2025-10-30&endDate=2025-11-05&ids=...
–ù–µ–¥–µ–ª—è 2: GET /adv/v3/fullstats?beginDate=2025-10-23&endDate=2025-10-29&ids=...
–ù–µ–¥–µ–ª—è 3: GET /adv/v3/fullstats?beginDate=2025-10-16&endDate=2025-10-22&ids=...
...
```

## –†–µ—à–µ–Ω–∏–µ

**–ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–∞–º–ø–∞–Ω–∏–π –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç—Å—è **–û–î–ò–ù –†–ê–ó** –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 31 –¥–µ–Ω—å (–º–∞–∫—Å–∏–º—É–º –ø–æ API)
- –î–∞–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è –ø–æ –¥–∞—Ç–∞–º –¥–ª—è –∫–∞–∂–¥–æ–π –Ω–µ–¥–µ–ª–∏
- **1 –∑–∞–ø—Ä–æ—Å** –≤–º–µ—Å—Ç–æ 9

## –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

### 1. –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è `fetchCampaignStatsOnce`

–ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –û–î–ò–ù –†–ê–ó –ø–µ—Ä–µ–¥ —Ü–∏–∫–ª–æ–º –ø–æ –Ω–µ–¥–µ–ª—è–º.

**–£–º–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–µ—Ä–∏–æ–¥–∞:**
- –ù–∞—Ö–æ–¥–∏—Ç —Å–∞–º—É—é —Ä–∞–Ω–Ω—é—é –¥–∞—Ç—É —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞–º–ø–∞–Ω–∏–∏
- –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Å —ç—Ç–æ–π –¥–∞—Ç—ã –¥–æ —Å–µ–≥–æ–¥–Ω—è
- –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç 31 –¥–Ω–µ–º (–ª–∏–º–∏—Ç API)

**–ü—Ä–∏–º–µ—Ä:**
- –ö–∞–º–ø–∞–Ω–∏—è —Å–æ–∑–¥–∞–Ω–∞: 11.08.2025
- –°–µ–≥–æ–¥–Ω—è: 06.11.2025
- –†–∞–∑–Ω–∏—Ü–∞: ~87 –¥–Ω–µ–π
- **–ó–∞–ø—Ä–æ—Å:** –ø–æ—Å–ª–µ–¥–Ω–∏–µ 31 –¥–µ–Ω—å (–∏–∑-–∑–∞ –ª–∏–º–∏—Ç–∞ API)

```typescript
// –ü–æ–ª—É—á–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∫–∞–º–ø–∞–Ω–∏–π –û–î–ò–ù –†–ê–ó –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 31 –¥–µ–Ω—å
const campaignStatsGlobal = await fetchCampaignStatsOnce(apiToken, nmId, subjectId, allCampaigns);

// –ó–∞—Ç–µ–º –∏—â–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–µ–¥–µ–ª—è –∑–∞ –Ω–µ–¥–µ–ª–µ–π
while (weeksSearched < maxWeeksBack && totalDataPoints < targetDataPoints) {
  const weekData = await fetchWeekData(
    apiToken,
    nmId,
    subjectId,
    startDateStr,
    endDateStr,
    allCampaigns,
    campaignStatsGlobal // –ü–µ—Ä–µ–¥–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
  );
}
```

### 2. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –¥–∞—Ç–∞–º –≤ `fetchWeekData`

–í–º–µ—Å—Ç–æ –∑–∞–ø—Ä–æ—Å–∞ API - —Ñ–∏–ª—å—Ç—Ä—É–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:

```typescript
// –ë–´–õ–û: –ó–∞–ø—Ä–æ—Å –¥–ª—è –∫–∞–∂–¥–æ–π –Ω–µ–¥–µ–ª–∏
const statsResponse = await fetch(statsUrl, ...);

// –°–¢–ê–õ–û: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
const weekCampaignStats = campaignStatsGlobal.filter((stat: any) => {
  if (stat.days && Array.isArray(stat.days)) {
    return stat.days.some((day: any) => {
      const dayDate = new Date(day.date);
      return dayDate >= periodStart && dayDate <= periodEnd;
    });
  }
  return false;
});
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

### 1. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- ‚úÖ **9x –º–µ–Ω—å—à–µ –∑–∞–ø—Ä–æ—Å–æ–≤** –∫ API (1 –≤–º–µ—Å—Ç–æ 9)
- ‚úÖ **–ë—ã—Å—Ç—Ä–µ–µ** - –Ω–µ—Ç –æ–∂–∏–¥–∞–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
- ‚úÖ **–ú–µ–Ω—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∞** –Ω–∞ API WB

### 2. –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å
- ‚úÖ **–ù–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤** - –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã –æ–¥–∏–Ω —Ä–∞–∑
- ‚úÖ **–ú–µ–Ω—å—à–µ –æ—à–∏–±–æ–∫** - –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å –≤–º–µ—Å—Ç–æ –¥–µ–≤—è—Ç–∏
- ‚úÖ **–ü—Ä–æ—â–µ –æ—Ç–ª–∞–¥–∫–∞** - –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ

### 3. –õ–∏–º–∏—Ç—ã API
- ‚úÖ **–ú–µ–Ω—å—à–µ —Ä–∏—Å–∫ rate limit** (429 Too Many Requests)
- ‚úÖ **–≠–∫–æ–Ω–æ–º–∏—è –∫–≤–æ—Ç—ã** –∑–∞–ø—Ä–æ—Å–æ–≤

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–î–æ:**
```
üìÖ [Smart Optimization] –ù–µ–¥–µ–ª—è 1: 2025-10-30 - 2025-11-05
   üì§ –ó–∞–ø—Ä–æ—Å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫–∞–º–ø–∞–Ω–∏–π: 2 —à—Ç (IDs: 27673276,20377168)
   ‚ùå –ö–∞–º–ø–∞–Ω–∏–∏ (fullstats): 400 {"detail":"Invalid begin date"}

üìÖ [Smart Optimization] –ù–µ–¥–µ–ª—è 2: 2025-10-23 - 2025-10-29
   üì§ –ó–∞–ø—Ä–æ—Å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫–∞–º–ø–∞–Ω–∏–π: 2 —à—Ç (IDs: 27673276,20377168)
   ‚ùå –ö–∞–º–ø–∞–Ω–∏–∏ (fullstats): 400 {"detail":"Invalid begin date"}
```

**–ü–æ—Å–ª–µ:**
```
üìä [Campaign Stats] –ó–∞–ø—Ä–æ—Å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∑–∞ –ø–µ—Ä–∏–æ–¥: 2025-10-06..2025-11-06
   üîç –ù–∞–π–¥–µ–Ω–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –∫–∞–º–ø–∞–Ω–∏–π: 2 –∏–∑ 27
   üì§ –ó–∞–ø—Ä–æ—Å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏: 2 –∫–∞–º–ø–∞–Ω–∏–π (IDs: 27673276,20377168)
   ‚úÖ –ü–æ–ª—É—á–µ–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: 2 –∫–∞–º–ø–∞–Ω–∏–π
      –ö–∞–º–ø–∞–Ω–∏—è 27673276: –ø—Ä–æ—Å–º–æ—Ç—Ä—ã=1500, –∫–ª–∏–∫–∏=75, –∑–∞–∫–∞–∑—ã=8
      –ö–∞–º–ø–∞–Ω–∏—è 20377168: –ø—Ä–æ—Å–º–æ—Ç—Ä—ã=2000, –∫–ª–∏–∫–∏=100, –∑–∞–∫–∞–∑—ã=10

üìÖ [Smart Optimization] –ù–µ–¥–µ–ª—è 1: 2025-10-30 - 2025-11-05
   üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–∞–º–ø–∞–Ω–∏–π (–∏–∑ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö): 2 –∫–∞–º–ø–∞–Ω–∏–π
      –ö–∞–º–ø–∞–Ω–∏—è 27673276: –ø—Ä–æ—Å–º–æ—Ç—Ä—ã=500, –∫–ª–∏–∫–∏=25, –∑–∞–∫–∞–∑—ã=3

üìÖ [Smart Optimization] –ù–µ–¥–µ–ª—è 2: 2025-10-23 - 2025-10-29
   üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–∞–º–ø–∞–Ω–∏–π (–∏–∑ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö): 2 –∫–∞–º–ø–∞–Ω–∏–π
      –ö–∞–º–ø–∞–Ω–∏—è 27673276: –ø—Ä–æ—Å–º–æ—Ç—Ä—ã=600, –∫–ª–∏–∫–∏=30, –∑–∞–∫–∞–∑—ã=4
```

## –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è API

**WB API `/adv/v3/fullstats`:**
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥: **31 –¥–µ–Ω—å**
- –õ–∏–º–∏—Ç: **3 –∑–∞–ø—Ä–æ—Å–∞ –≤ –º–∏–Ω—É—Ç—É**

**–†–µ—à–µ–Ω–∏–µ:**
- –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 31 –¥–µ–Ω—å –û–î–ò–ù –†–ê–ó
- –î–ª—è –±–æ–ª–µ–µ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö (>31 –¥–µ–Ω—å) —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–∞ —á–µ—Ä–µ–∑ —ç—Ç–æ—Ç API

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö

–ï—Å–ª–∏ –Ω—É–∂–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å—Ç–∞—Ä—à–µ 31 –¥–Ω—è:

### 1. `/adv/v0/stats/keywords` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Ñ—Ä–∞–∑–∞–º
```typescript
GET /adv/v0/stats/keywords?advert_id=27673276&from=2025-08-11&to=2025-08-17
```
- **–ü–µ—Ä–∏–æ–¥:** –¥–æ 7 –¥–Ω–µ–π
- **–î–∞–Ω–Ω—ã–µ:** clicks, ctr, keyword, sum, views
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** –ó–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å –ø–æ –Ω–µ–¥–µ–ª—è–º –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞

### 2. `/adv/v1/upd` - –ò—Å—Ç–æ—Ä–∏—è –∑–∞—Ç—Ä–∞—Ç
```typescript
GET /adv/v1/upd?from=2025-08-11&to=2025-09-10
```
- **–ü–µ—Ä–∏–æ–¥:** –¥–æ 31 –¥–Ω—è
- **–î–∞–Ω–Ω—ã–µ:** updSum (–∑–∞—Ç—Ä–∞—Ç—ã), advertId, campName
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** –û–±—â–∏–µ –∑–∞—Ç—Ä–∞—Ç—ã –±–µ–∑ –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏

### 3. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –ë–î
- –°–æ—Ö—Ä–∞–Ω—è—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ
- –ù–∞–∫–∞–ø–ª–∏–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ
- –°—Ç—Ä–æ–∏—Ç—å –æ—Ç—á–µ—Ç—ã –∑–∞ –ª—é–±–æ–π –ø–µ—Ä–∏–æ–¥

## –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã

- `src/app/api/products/[id]/smart-optimization-data/route.ts`
  - –°—Ç—Ä–æ–∫–∏ 77-78: –ó–∞–ø—Ä–æ—Å –≥–ª–æ–±–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–µ—Ä–µ–¥ —Ü–∏–∫–ª–æ–º
  - –°—Ç—Ä–æ–∫–∏ 361-443: –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è `fetchCampaignStatsOnce`
  - –°—Ç—Ä–æ–∫–∏ 452-453: –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `campaignStatsGlobal`
  - –°—Ç—Ä–æ–∫–∏ 874-908: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≥–ª–æ–±–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤–º–µ—Å—Ç–æ –∑–∞–ø—Ä–æ—Å–∞

## –†–µ–∑—É–ª—å—Ç–∞—Ç

**–ë—ã–ª–æ:**
- 9 –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API
- –ú–Ω–æ–∂–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ 400/429
- –î—É–±–ª–∏–∫–∞—Ç—ã –¥–∞–Ω–Ω—ã—Ö

**–°—Ç–∞–ª–æ:**
- 1 –∑–∞–ø—Ä–æ—Å –∫ API
- –ù–µ—Ç –æ—à–∏–±–æ–∫
- –ß–∏—Å—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ –±–µ–∑ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

üéØ **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è: 9x –º–µ–Ω—å—à–µ –∑–∞–ø—Ä–æ—Å–æ–≤!**
