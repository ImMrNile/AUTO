# ๐ ะะฒัะพะผะฐัะธัะตัะบะธะน ัะฑะพั ะธััะพัะธัะตัะบะธั ะดะฐะฝะฝัั ะทะฐ ะปัะฑะพะน ะฟะตัะธะพะด

## โ ะงัะพ ัะตะฐะปะธะทะพะฒะฐะฝะพ

ะกะธััะตะผะฐ ะฐะฒัะพะผะฐัะธัะตัะบะธ ัะพะฑะธัะฐะตั ะดะฐะฝะฝัะต ะพ ัะพะฒะฐัะต ะทะฐ **ะปัะฑะพะน ะฟะตัะธะพะด** (ะดะฐะถะต ะตัะปะธ ัะพะฒะฐัะฐ ะฝะตั ะฒ ะฝะฐะปะธัะธะธ), ะดะตะปะฐั ะฟะพัะปะตะดะพะฒะฐัะตะปัะฝัะต ะทะฐะฟัะพัั ะบ WB API.

## ๐ฏ ะะฐะบ ััะพ ัะฐะฑะพัะฐะตั

### 1. ะะฐะทะฑะธะฒะบะฐ ะฝะฐ ะพะบะฝะฐ

ะะพะปััะพะน ะฟะตัะธะพะด (ะฝะฐะฟัะธะผะตั, 60 ะดะฝะตะน) ัะฐะทะฑะธะฒะฐะตััั ะฝะฐ **ะฝะตะดะตะปัะฝัะต ะพะบะฝะฐ** ะฟะพ 7 ะดะฝะตะน:

```
60 ะดะฝะตะน = 9 ะพะบะพะฝ ะฟะพ 7 ะดะฝะตะน:
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ะะบะฝะพ 1: 05.09 - 11.09 (7 ะดะฝะตะน)                    โ
โ ะะบะฝะพ 2: 12.09 - 18.09 (7 ะดะฝะตะน)                    โ
โ ะะบะฝะพ 3: 19.09 - 25.09 (7 ะดะฝะตะน)                    โ
โ ะะบะฝะพ 4: 26.09 - 02.10 (7 ะดะฝะตะน)                    โ
โ ะะบะฝะพ 5: 03.10 - 09.10 (7 ะดะฝะตะน)                    โ
โ ะะบะฝะพ 6: 10.10 - 16.10 (7 ะดะฝะตะน)                    โ
โ ะะบะฝะพ 7: 17.10 - 23.10 (7 ะดะฝะตะน)                    โ
โ ะะบะฝะพ 8: 24.10 - 30.10 (7 ะดะฝะตะน)                    โ
โ ะะบะฝะพ 9: 31.10 - 05.11 (6 ะดะฝะตะน)                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### 2. ะะพัะปะตะดะพะฒะฐัะตะปัะฝัะน ัะฑะพั

ะกะธััะตะผะฐ ะดะตะปะฐะตั ะทะฐะฟัะพัั **ะฟะพัะปะตะดะพะฒะฐัะตะปัะฝะพ** ั ะทะฐะดะตัะถะบะพะน 2 ัะตะบัะฝะดั ะผะตะถะดั ะพะบะฝะฐะผะธ:

```typescript
for (let i = 0; i < weeklyWindows.length; i++) {
  const window = weeklyWindows[i];
  
  // ะะฐะฟัะพั ะดะฐะฝะฝัั ะทะฐ ะพะบะฝะพ
  const data = await fetchWindowData(apiToken, nmId, window.startDate, window.endDate);
  allData.push(data);
  
  // ะะฐะดะตัะถะบะฐ 2 ัะตะบัะฝะดั ะฟะตัะตะด ัะปะตะดัััะธะผ ะทะฐะฟัะพัะพะผ
  await new Promise(resolve => setTimeout(resolve, 2000));
}
```

### 3. ะะณัะตะณะฐัะธั ะดะฐะฝะฝัั

ะัะต ะดะฐะฝะฝัะต ะธะท ะพะบะพะฝ **ััะผะผะธัััััั** ะฒ ะตะดะธะฝัะน ะพััะตั:

```typescript
{
  totalViews: 4713,        // ะกัะผะผะฐ ะฟัะพัะผะพััะพะฒ ะทะฐ ะฒัะต ะพะบะฝะฐ
  totalCart: 228,          // ะกัะผะผะฐ ะดะพะฑะฐะฒะปะตะฝะธะน ะฒ ะบะพัะทะธะฝั
  totalOrders: 42,         // ะกัะผะผะฐ ะทะฐะบะฐะทะพะฒ
  totalBuyouts: 26,        // ะกัะผะผะฐ ะฒัะบัะฟะพะฒ
  avgPrice: 3532,          // ะกัะตะดะฝะธะน ัะตะบ
  conversions: {
    addToCartPercent: 4.84,      // 228 / 4713 * 100
    cartToOrderPercent: 18.42,   // 42 / 228 * 100
    buyoutPercent: 61.90         // 26 / 42 * 100
  }
}
```

## ๐ก API Endpoint

### GET `/api/products/[id]/historical-data`

**Query ะฟะฐัะฐะผะตััั:**
- `days` - ะบะพะปะธัะตััะฒะพ ะดะฝะตะน ะดะปั ัะฑะพัะฐ (ะฟะพ ัะผะพะปัะฐะฝะธั 60)

**ะัะธะผะตัั ะทะฐะฟัะพัะพะฒ:**

```bash
# 2 ะผะตัััะฐ (60 ะดะฝะตะน) - ะฟะพ ัะผะพะปัะฐะฝะธั
GET /api/products/cmh0gghd5002bunv4jxmcdfue/historical-data

# 3 ะผะตัััะฐ (90 ะดะฝะตะน)
GET /api/products/cmh0gghd5002bunv4jxmcdfue/historical-data?days=90

# 6 ะผะตัััะตะฒ (180 ะดะฝะตะน)
GET /api/products/cmh0gghd5002bunv4jxmcdfue/historical-data?days=180

# 1 ะณะพะด (365 ะดะฝะตะน)
GET /api/products/cmh0gghd5002bunv4jxmcdfue/historical-data?days=365
```

## ๐ ะคะพัะผะฐั ะพัะฒะตัะฐ

```json
{
  "success": true,
  "productId": "cmh0gghd5002bunv4jxmcdfue",
  "nmId": "493805274",
  "totalDays": 60,
  "windowsCollected": 9,
  "windowsTotal": 9,
  "aggregated": {
    "totalViews": 4713,
    "totalCart": 228,
    "totalOrders": 42,
    "totalOrderSum": 148334,
    "totalBuyouts": 26,
    "totalBuyoutSum": 82431,
    "totalCancels": 14,
    "totalCancelSum": 57987,
    "totalWishlist": 92,
    "avgPrice": 3532,
    "conversions": {
      "addToCartPercent": 4.84,
      "cartToOrderPercent": 18.42,
      "buyoutPercent": 61.90
    }
  },
  "rawData": [
    {
      "startDate": "2025-09-05",
      "endDate": "2025-09-11",
      "data": { ... }
    },
    ...
  ],
  "errors": null
}
```

## ๐ ะงัะพ ะผะพะถะฝะพ ัะทะฝะฐัั ะธะท ะธััะพัะธัะตัะบะธั ะดะฐะฝะฝัั

### 1. ะะพะณะดะฐ ัะพะฒะฐั ะฟัะพะดะฐะฒะฐะปัั ัะพัะพัะพ
```
ะะบะฝะพ 1 (05.09-11.09): 42 ะทะฐะบะฐะทะฐ, 5% ะบะพะฝะฒะตััะธั โ
ะะบะฝะพ 2 (12.09-18.09): 38 ะทะฐะบะฐะทะพะฒ, 4.8% ะบะพะฝะฒะตััะธั โ
ะะบะฝะพ 3 (19.09-25.09): 45 ะทะฐะบะฐะทะพะฒ, 5.2% ะบะพะฝะฒะตััะธั โ ะะฃะงะจะะ
ะะบะฝะพ 4 (26.09-02.10): 35 ะทะฐะบะฐะทะพะฒ, 4.5% ะบะพะฝะฒะตััะธั โ
```

### 2. ะะพะณะดะฐ ะฝะฐัะฐะปัั ัะฟะฐะด
```
ะะบะฝะพ 5 (03.10-09.10): 12 ะทะฐะบะฐะทะพะฒ, 3% ะบะพะฝะฒะตััะธั โ๏ธ ะกะะะ
ะะบะฝะพ 6 (10.10-16.10): 4 ะทะฐะบะฐะทะฐ, 2% ะบะพะฝะฒะตััะธั โ ะะะะขะะงะะ
ะะบะฝะพ 7 (17.10-23.10): 0 ะทะฐะบะฐะทะพะฒ, 0% ะบะพะฝะฒะตััะธั โ ะะะข ะะกะขะะขะะะ
```

### 3. ะกัะตะดะฝะธะต ะฟะพะบะฐะทะฐัะตะปะธ ะทะฐ ะฟะตัะธะพะด
```
ะกัะตะดะฝัั ะบะพะฝะฒะตััะธั: 4.84% (ะบะพะณะดะฐ ัะพะฒะฐั ะฑัะป ะฒ ะฝะฐะปะธัะธะธ)
ะกัะตะดะฝะธะน ัะตะบ: 3,532โฝ
ะกัะตะดะฝะธะน ะฒัะบัะฟ: 61.90%
```

## โฑ๏ธ ะัะตะผั ะฒัะฟะพะปะฝะตะฝะธั

**ะคะพัะผัะปะฐ:** `(ะบะพะปะธัะตััะฒะพ ะพะบะพะฝ - 1) ร 2 ัะตะบัะฝะดั + ะฒัะตะผั ะทะฐะฟัะพัะพะฒ`

**ะัะธะผะตัั:**
- 60 ะดะฝะตะน (9 ะพะบะพะฝ): ~16-20 ัะตะบัะฝะด
- 90 ะดะฝะตะน (13 ะพะบะพะฝ): ~24-30 ัะตะบัะฝะด
- 180 ะดะฝะตะน (26 ะพะบะพะฝ): ~50-60 ัะตะบัะฝะด
- 365 ะดะฝะตะน (53 ะพะบะฝะฐ): ~106-120 ัะตะบัะฝะด

## ๐ฏ ะัะฐะบัะธัะตัะบะพะต ะฟัะธะผะตะฝะตะฝะธะต

### ะะปั ะฒะฐัะตะณะพ ัะพะฒะฐัะฐ (nmID: 493805274)

**ะขะตะบััะฐั ัะธััะฐัะธั:**
- ะขะพะฒะฐัะฐ ะฝะตั ะฒ ะฝะฐะปะธัะธะธ 2 ะผะตัััะฐ
- ะะฐะฝััะต ะฟัะพะดะฐะฒะฐะปะธ 20-30 ัั/ะฝะตะดะตะปั
- ะกะตะนัะฐั: 4 ะทะฐะบะฐะทะฐ ะทะฐ ะผะตััั

**ะงัะพ ะดะตะปะฐัั:**

1. **ะกะพะฑัะฐัั ะดะฐะฝะฝัะต ะทะฐ ะฟะตัะธะพะด ะบะพะณะดะฐ ัะพะฒะฐั ะฟัะพะดะฐะฒะฐะปัั:**
```bash
GET /api/products/cmh0gghd5002bunv4jxmcdfue/historical-data?days=90
```

2. **ะัะพะฐะฝะฐะปะธะทะธัะพะฒะฐัั:**
- ะะฐะบะฐั ะฑัะปะฐ ะบะพะฝะฒะตััะธั? (ัะตะปั: >5%)
- ะะฐะบะพะน ะฑัะป ััะตะดะฝะธะน ัะตะบ? (ัะตะนัะฐั 3,909โฝ, ะฑัะปะพ 3,532โฝ)
- ะกะบะพะปัะบะพ ะฟัะพัะผะพััะพะฒ ะฟัะธะฒะพะดะธะปะพ ะบ ะทะฐะบะฐะทั? (ะฑัะปะพ 4,713 โ 42 ะทะฐะบะฐะทะฐ)

3. **ะะพัััะฐะฝะพะฒะธัั ะฟัะพะดะฐะถะธ:**
- ะะพะฟะพะปะฝะธัั ะพััะฐัะบะธ (ะผะธะฝะธะผัะผ 100 ัั)
- ะะตัะฝััั ัะตะฝั ะบ ~3,500โฝ
- ะะฐะฟัััะธัั ัะตะบะปะฐะผั ั ัะตะผะธ ะถะต ะบะปััะตะฒัะผะธ ัะปะพะฒะฐะผะธ

## ๐ ะัะธะผะตั ะธัะฟะพะปัะทะพะฒะฐะฝะธั ะฒ ะบะพะดะต

```typescript
// ะะพะปััะธัั ะดะฐะฝะฝัะต ะทะฐ 2 ะผะตัััะฐ
const response = await fetch(
  `/api/products/${productId}/historical-data?days=60`
);

const data = await response.json();

if (data.success) {
  console.log(`ะกะพะฑัะฐะฝะพ ${data.windowsCollected}/${data.windowsTotal} ะพะบะพะฝ`);
  console.log('ะะณัะตะณะธัะพะฒะฐะฝะฝัะต ะดะฐะฝะฝัะต:', data.aggregated);
  
  // ะะฝะฐะปะธะท
  const { aggregated } = data;
  console.log(`ะัะพัะผะพััั: ${aggregated.totalViews}`);
  console.log(`ะะฐะบะฐะทั: ${aggregated.totalOrders}`);
  console.log(`ะะพะฝะฒะตััะธั: ${aggregated.conversions.addToCartPercent}%`);
  console.log(`ะกัะตะดะฝะธะน ัะตะบ: ${aggregated.avgPrice}โฝ`);
}
```

## ๐จ ะะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ

ะกะธััะตะผะฐ **ะฟัะพะดะพะปะถะฐะตั ัะฐะฑะพัั** ะดะฐะถะต ะตัะปะธ ะฝะตะบะพัะพััะต ะพะบะฝะฐ ะฒะตัะฝัะปะธ ะพัะธะฑะบั:

```json
{
  "windowsCollected": 7,
  "windowsTotal": 9,
  "errors": [
    "ะะบะฝะพ 8 (24.10-30.10): WB API error: 429",
    "ะะบะฝะพ 9 (31.10-05.11): WB API error: 429"
  ]
}
```

ะ ััะพะผ ัะปััะฐะต ะฒั ะฟะพะปััะธัะต **ัะฐััะธัะฝัะต ะดะฐะฝะฝัะต** ะทะฐ 7 ะธะท 9 ะพะบะพะฝ.

## ๐ก ะะตะบะพะผะตะฝะดะฐัะธะธ

### 1. ะะปั ะฐะฝะฐะปะธะทะฐ ะฟัะพัะปัั ะฟัะพะดะฐะถ
ะะฐะฟัะฐัะธะฒะฐะนัะต **90-180 ะดะฝะตะน** ััะพะฑั ัะฒะธะดะตัั ะฟะพะปะฝัั ะบะฐััะธะฝั:
```
GET /api/products/[id]/historical-data?days=180
```

### 2. ะะปั ะฑััััะพะณะพ ะฐะฝะฐะปะธะทะฐ
ะะฐะฟัะฐัะธะฒะฐะนัะต **30-60 ะดะฝะตะน**:
```
GET /api/products/[id]/historical-data?days=30
```

### 3. ะะปั ะณะปัะฑะพะบะพะณะพ ะฐะฝะฐะปะธะทะฐ
ะะฐะฟัะฐัะธะฒะฐะนัะต **365 ะดะฝะตะน** (ะทะฐะนะผะตั ~2 ะผะธะฝััั):
```
GET /api/products/[id]/historical-data?days=365
```

## ๐ ะะพะณะธ ะฒ ะบะพะฝัะพะปะธ

```
๐ [Historical Data] ะะฐะฟัะพั ะฒัะตั ะดะฐะฝะฝัั ะดะปั ัะพะฒะฐัะฐ: cmh0gghd5002bunv4jxmcdfue
๐ [Historical Data] ะะฐะฟัะพัะตะฝ ะฟะตัะธะพะด: 60 ะดะฝะตะน
๐ [Historical Data] ะะพะปััะตะฝะธะต ะดะฐะฝะฝัั ะทะฐ 60 ะดะฝะตะน ะดะปั nmID: 493805274
๐ฆ [Historical Data] ะะฐะทะฑะธัะพ ะฝะฐ 9 ะฝะตะดะตะปัะฝัั ะพะบะพะฝ
๐ [Historical Data] ะะบะฝะพ 1/9: 2025-09-05 - 2025-09-11
โ [Historical Data] ะะบะฝะพ 1 ะฟะพะปััะตะฝะพ
๐ [Historical Data] ะะบะฝะพ 2/9: 2025-09-12 - 2025-09-18
โ [Historical Data] ะะบะฝะพ 2 ะฟะพะปััะตะฝะพ
...
โ [Historical Data] ะกะพะฑัะฐะฝะพ 9/9 ะพะบะพะฝ
```

## โ ะะตะทัะปััะฐั

ะขะตะฟะตัั ะฒั ะผะพะถะตัะต ะฟะพะปััะธัั **ะฟะพะปะฝัะต ะธััะพัะธัะตัะบะธะต ะดะฐะฝะฝัะต** ะทะฐ ะปัะฑะพะน ะฟะตัะธะพะด, ะดะฐะถะต ะตัะปะธ ัะพะฒะฐัะฐ ะฝะตั ะฒ ะฝะฐะปะธัะธะธ! ๐

ะกะธััะตะผะฐ ะฐะฒัะพะผะฐัะธัะตัะบะธ:
- โ ะะฐะทะฑะธะฒะฐะตั ะฟะตัะธะพะด ะฝะฐ ะพะบะฝะฐ
- โ ะะตะปะฐะตั ะฟะพัะปะตะดะพะฒะฐัะตะปัะฝัะต ะทะฐะฟัะพัั
- โ ะะณัะตะณะธััะตั ะฒัะต ะดะฐะฝะฝัะต
- โ ะะฑัะฐะฑะฐััะฒะฐะตั ะพัะธะฑะบะธ
- โ ะะพะทะฒัะฐัะฐะตั ะฟะพะปะฝัะน ะพััะตั

ะญัะพ ะฟะพะทะฒะพะปะธั ะฒะฐะผ **ะฟัะพะฐะฝะฐะปะธะทะธัะพะฒะฐัั** ััะพ ัะฐะฑะพัะฐะปะพ ัะฐะฝััะต ะธ **ะฒะพัััะฐะฝะพะฒะธัั ะฟัะพะดะฐะถะธ** ะฟะพัะปะต ะฟะพะฟะพะปะฝะตะฝะธั ะพััะฐัะบะพะฒ!
