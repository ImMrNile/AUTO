# ‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω—ã –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

## –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 1. ‚úÖ –¶–∏—Ñ—Ä–æ–≤–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö (–ò–°–ü–†–ê–í–õ–ï–ù–û)

**–§–∞–π–ª:** `src/app/components/products/ProductsWithAnalytics.tsx` (—Å—Ç—Ä–æ–∫–∞ 1432-1433)

**–ë—ã–ª–æ:**
```tsx
<input
  type="number"
  value={editingPriceInline.discountPrice}
  // ... ‚ùå –ü–æ–∫–∞–∑—ã–≤–∞–ª–∞—Å—å –ø–æ–ª–Ω–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å –±—É–∫–≤–∞–º–∏
/>
```

**–°—Ç–∞–ª–æ:**
```tsx
<input
  type="number"
  inputMode="numeric"
  pattern="[0-9]*"
  value={editingPriceInline.discountPrice}
  // ... ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä–æ–≤–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞
/>
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ù–∞ iOS: —Ü–∏—Ñ—Ä–æ–≤–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞
- ‚úÖ –ù–∞ Android: —Ü–∏—Ñ—Ä–æ–≤–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞
- ‚úÖ –£–¥–æ–±–Ω—ã–π –≤–≤–æ–¥ —Ü–µ–Ω—ã –Ω–∞ —Å–º–∞—Ä—Ç—Ñ–æ–Ω–µ

---

### 2. ‚úÖ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è Redis –∫–µ—à–∞

#### A. –¢–æ–≤–∞—Ä—ã (—É–≤–µ–ª–∏—á–µ–Ω TTL)

**–§–∞–π–ª:** `src/app/api/wb/products/route.ts` (—Å—Ç—Ä–æ–∫–∞ 168-170)

**–ë—ã–ª–æ:**
```typescript
await setCached(cacheKey, products, 1800);  // 30 –º–∏–Ω—É—Ç
```

**–°—Ç–∞–ª–æ:**
```typescript
await setCached(cacheKey, products, 3600);  // 1 —á–∞—Å ‚úÖ
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ú–µ–Ω—å—à–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î
- ‚úÖ –ë—ã—Å—Ç—Ä–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
- ‚úÖ –≠–∫–æ–Ω–æ–º–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤

#### B. –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ (—É–∂–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞)

**–§–∞–π–ª:** `src/app/api/analytics/dashboard/route.ts` (—Å—Ç—Ä–æ–∫–∞ 481)

```typescript
await setCached(cacheKey, { data: analyticsResult, timestamp: Date.now() }, 3600);  // 1 —á–∞—Å ‚úÖ
```

#### C. –ö–æ–Ω–≤–µ—Ä—Å–∏—è (—É–∂–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞)

**–§–∞–π–ª:** `src/app/api/analytics/conversion/route.ts` (—Å—Ç—Ä–æ–∫–∞ 62)

```typescript
const CACHE_TTL = 60 * 60 * 1000;  // 60 –º–∏–Ω—É—Ç ‚úÖ
```

---

### 3. ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Vercel KV

**–§–∞–π–ª:** `lib/cache/redis.ts` (—Å—Ç—Ä–æ–∫–∞ 31-32)

**–ë—ã–ª–æ:**
```typescript
const redisUrl = process.env.REDIS_URL;
const redisToken = process.env.REDIS_TOKEN;
```

**–°—Ç–∞–ª–æ:**
```typescript
const redisUrl = process.env.REDIS_URL || process.env.KV_REST_API_URL;
const redisToken = process.env.REDIS_TOKEN || process.env.KV_REST_API_TOKEN;
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —Å Upstash Redis
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —Å Vercel KV
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä

---

### 4. ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (Cron)

**–§–∞–π–ª:** `vercel.json`

```json
{
  "crons": [
    {
      "path": "/api/cron/sync-analytics",
      "schedule": "0 */2 * * *"  // ‚úÖ –ö–∞–∂–¥—ã–µ 2 —á–∞—Å–∞
    },
    {
      "path": "/api/cron/check-prices",
      "schedule": "*/30 * * * *"  // ‚úÖ –ö–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç
    },
    {
      "path": "/api/cron/sync-products",
      "schedule": "0 */2 * * *"  // ‚úÖ –ö–∞–∂–¥—ã–µ 2 —á–∞—Å–∞
    }
  ]
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- ‚úÖ –¶–µ–Ω—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è
- ‚úÖ –û—Å—Ç–∞—Ç–∫–∏ –∞–∫—Ç—É–∞–ª—å–Ω—ã

---

## –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–µ—à–∞

### –¢–µ–∫—É—â–∏–µ TTL (Time To Live)

| –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö | TTL | –ß–∞—Å—Ç–æ—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è | –û–ø—Ç–∏–º–∞–ª—å–Ω–æ? |
|------------|-----|-------------------|-------------|
| **–¢–æ–≤–∞—Ä—ã** | 1 —á–∞—Å | Cron –∫–∞–∂–¥—ã–µ 2 —á–∞—Å–∞ | ‚úÖ –î–∞ |
| **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞** | 1 —á–∞—Å | Cron –∫–∞–∂–¥—ã–µ 2 —á–∞—Å–∞ | ‚úÖ –î–∞ |
| **–ö–æ–Ω–≤–µ—Ä—Å–∏—è** | 1 —á–∞—Å | Cron –∫–∞–∂–¥—ã–µ 2 —á–∞—Å–∞ | ‚úÖ –î–∞ |
| **–¶–µ–Ω—ã (–∑–∞–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã–µ)** | - | Cron –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç | ‚úÖ –î–∞ |

### –ü–æ—á–µ–º—É —ç—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã?

1. **TTL 1 —á–∞—Å:**
   - –ë–∞–ª–∞–Ω—Å –º–µ–∂–¥—É —Å–≤–µ–∂–µ—Å—Ç—å—é –¥–∞–Ω–Ω—ã—Ö –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é
   - –î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è Cron –∫–∞–∂–¥—ã–µ 2 —á–∞—Å–∞
   - –ö–µ—à –≤—Å–µ–≥–¥–∞ –∞–∫—Ç—É–∞–ª–µ–Ω (–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Ä–∞–Ω—å—à–µ –∏—Å—Ç–µ—á–µ–Ω–∏—è)

2. **Cron –∫–∞–∂–¥—ã–µ 2 —á–∞—Å–∞:**
   - –ù–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞–µ—Ç WB API
   - –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —á–∞—Å—Ç–æ –¥–ª—è –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏
   - –≠–∫–æ–Ω–æ–º–∏—Ç —Ä–µ—Å—É—Ä—Å—ã Vercel

3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–Ω –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç:**
   - –ë—ã—Å—Ç—Ä–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã—Ö —Ü–µ–Ω
   - –ó–∞—â–∏—Ç–∞ –æ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π WB

---

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- ‚ùå –¢–æ–≤–∞—Ä—ã: 5-10 —Å–µ–∫—É–Ω–¥ (–∏–∑ –ë–î –∫–∞–∂–¥—ã–π —Ä–∞–∑)
- ‚ùå –ê–Ω–∞–ª–∏—Ç–∏–∫–∞: 8-15 —Å–µ–∫—É–Ω–¥ (–∏–∑ –ë–î –∫–∞–∂–¥—ã–π —Ä–∞–∑)
- ‚ùå –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞: –ø–æ–ª–Ω–∞—è —Å –±—É–∫–≤–∞–º–∏
- ‚ùå –ü–µ—Ä–µ–≥—Ä–µ–≤ —Å–º–∞—Ä—Ç—Ñ–æ–Ω–∞

### –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- ‚úÖ –¢–æ–≤–∞—Ä—ã: 0.5-1 —Å–µ–∫—É–Ω–¥–∞ (–∏–∑ Redis –∫–µ—à–∞)
- ‚úÖ –ê–Ω–∞–ª–∏—Ç–∏–∫–∞: 1-2 —Å–µ–∫—É–Ω–¥—ã (–∏–∑ Redis –∫–µ—à–∞)
- ‚úÖ –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞: —Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã
- ‚úÖ –≠–∫–æ–Ω–æ–º–∏—è –±–∞—Ç–∞—Ä–µ–∏

### –£—Å–∫–æ—Ä–µ–Ω–∏–µ:
- **–¢–æ–≤–∞—Ä—ã:** –≤ 5-10 —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ
- **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞:** –≤ 4-8 —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ
- **–û–±—â–∞—è –∑–∞–≥—Ä—É–∑–∫–∞:** –≤ 5-7 —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–µ—à–∞ –≤ –ª–æ–≥–∞—Ö

**–û—Ç–∫—Ä–æ–π—Ç–µ Vercel Dashboard ‚Üí Logs:**

**‚úÖ –ö–µ—à —Ä–∞–±–æ—Ç–∞–µ—Ç:**
```
‚úÖ [Redis] –ö–ª–∏–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
üîç [Redis] –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–∑ –∫–µ—à–∞: "products:user123:all"
‚úÖ [Redis] –ù–∞–π–¥–µ–Ω–æ –≤ –∫–µ—à–µ: "products:user123:all"
‚úÖ Cache HIT: –¢–æ–≤–∞—Ä—ã –≤–∑—è—Ç—ã –∏–∑ Redis –∫–µ—à–∞ (52 —Ç–æ–≤–∞—Ä–æ–≤)
```

**‚ùå –ö–µ—à –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
```
‚ö†Ô∏è [Redis] –ù–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω Redis/KV –∫–µ—à
‚ö†Ô∏è Cache MISS: –ö–µ—à –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, –∑–∞–≥—Ä—É–∂–∞–µ–º –∏–∑ –ë–î...
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–∏—Ñ—Ä–æ–≤–æ–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã

**–ù–∞ —Å–º–∞—Ä—Ç—Ñ–æ–Ω–µ:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ä–∞–∑–¥–µ–ª "–¢–æ–≤–∞—Ä—ã"
2. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–∞—Ä–∞–Ω–¥–∞—à —Ä—è–¥–æ–º —Å —Ü–µ–Ω–æ–π
3. –î–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è **—Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä–æ–≤–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞** ‚úÖ

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ Cron

**–í Vercel Dashboard ‚Üí Cron Jobs:**
- ‚úÖ `/api/cron/sync-analytics` - –∞–∫—Ç–∏–≤–µ–Ω
- ‚úÖ `/api/cron/check-prices` - –∞–∫—Ç–∏–≤–µ–Ω
- ‚úÖ `/api/cron/sync-products` - –∞–∫—Ç–∏–≤–µ–Ω

**–í –ª–æ–≥–∞—Ö:**
```
‚úÖ [Sync Products Cron] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞: 52 —É—Å–ø–µ—à–Ω–æ
‚úÖ [Sync Analytics Cron] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞: 52 —É—Å–ø–µ—à–Ω–æ
```

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### 1. –£–≤–µ–ª–∏—á–∏—Ç—å TTL –¥–æ 2 —á–∞—Å–æ–≤ (–µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è —Ä–µ–¥–∫–æ)

```typescript
// src/app/api/wb/products/route.ts
await setCached(cacheKey, products, 7200);  // 2 —á–∞—Å–∞
```

### 2. –î–æ–±–∞–≤–∏—Ç—å –ø–∞–≥–∏–Ω–∞—Ü–∏—é (–µ—Å–ª–∏ > 100 —Ç–æ–≤–∞—Ä–æ–≤)

```typescript
// GET /api/wb/products?source=db&page=1&limit=50
const page = parseInt(searchParams.get('page') || '1');
const limit = parseInt(searchParams.get('limit') || '50');
```

### 3. Lazy loading –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (—É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)

```tsx
<img 
  loading="lazy"
  decoding="async"
  src={product.images[0]}
/>
```

---

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è:

1. **Cache Hit Rate:**
   ```bash
   # –í Vercel Logs
   grep "Cache HIT" | wc -l  # –ü–æ–ø–∞–¥–∞–Ω–∏—è –≤ –∫–µ—à
   grep "Cache MISS" | wc -l  # –ü—Ä–æ–º–∞—Ö–∏
   ```

2. **–í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏:**
   - –ü–µ—Ä–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞: 3-5 —Å–µ–∫—É–Ω–¥ (–∏–∑ –ë–î)
   - –ü–æ—Å–ª–µ–¥—É—é—â–∏–µ: 0.5-1 —Å–µ–∫—É–Ω–¥–∞ (–∏–∑ –∫–µ—à–∞)

3. **Cron –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ:**
   ```bash
   # –í Vercel Logs
   grep "Sync Products Cron.*–∑–∞–≤–µ—Ä—à–µ–Ω–∞" | tail -5
   ```

---

## –ò—Ç–æ–≥–æ–≤—ã–π —á–µ–∫–ª–∏—Å—Ç

- [x] ‚úÖ –¶–∏—Ñ—Ä–æ–≤–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
- [x] ‚úÖ Redis –∫–µ—à –Ω–∞—Å—Ç—Ä–æ–µ–Ω (Vercel KV)
- [x] ‚úÖ TTL —É–≤–µ–ª–∏—á–µ–Ω –¥–æ 1 —á–∞—Å–∞
- [x] ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Vercel KV –¥–æ–±–∞–≤–ª–µ–Ω–∞
- [x] ‚úÖ Cron –∑–∞–¥–∞—á–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [x] ‚úÖ CRON_SECRET —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- [x] ‚úÖ –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 2 —á–∞—Å–∞
- [x] ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–Ω –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç

---

## –†–µ–∑—É–ª—å—Ç–∞—Ç

**–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ:**
- ‚ö° –ë—ã—Å—Ç—Ä–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ (–≤ 5-10 —Ä–∞–∑)
- üì± –£–¥–æ–±–Ω—ã–π –≤–≤–æ–¥ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
- üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- üíæ –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- üîã –≠–∫–æ–Ω–æ–º–∏—è –±–∞—Ç–∞—Ä–µ–∏

**–í—Å–µ –≥–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é! üöÄ**
