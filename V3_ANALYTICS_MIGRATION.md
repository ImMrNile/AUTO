# –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ V3 Analytics API (–≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ 9 –¥–µ–∫–∞–±—Ä—è 2025)

## –ü—Ä–æ–±–ª–µ–º–∞

**9 –¥–µ–∫–∞–±—Ä—è 2025** WB –æ—Ç–∫–ª—é—á–∏—Ç —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ v2 —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:
- ‚ùå `/api/v2/nm-report/detail` ‚Üí –±—É–¥–µ—Ç —É–¥–∞–ª—ë–Ω
- ‚ùå `/api/v2/nm-report/grouped/history` ‚Üí –±—É–¥–µ—Ç —É–¥–∞–ª—ë–Ω
- ‚ùå `/api/v2/nm-report/detail/history` ‚Üí –±—É–¥–µ—Ç —É–¥–∞–ª—ë–Ω

## –†–µ—à–µ–Ω–∏–µ: –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ V3 Analytics API

### –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å –≤ –∫–æ–¥–µ

#### 1. –î–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç –ø–æ —Ç–æ–≤–∞—Ä—É

**–ë—ã–ª–æ (v2, deprecated):**
```typescript
// ‚ùå –£–¥–∞–ª—è—Ç 9 –¥–µ–∫–∞–±—Ä—è
fetch('https://seller-analytics-api.wildberries.ru/api/v2/nm-report/detail', {
  body: JSON.stringify({
    nmIDs: [nmId],
    period: {
      begin: "2025-10-29 00:00:00",
      end: "2025-11-04 23:59:59"
    },
    timezone: 'Europe/Moscow',
    aggregationLevel: 'day',
    page: 1
  })
})
```

**–°—Ç–∞–ª–æ (v3, –∞–∫—Ç—É–∞–ª—å–Ω–æ):**
```typescript
// ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —Å–µ–π—á–∞—Å –∏ –ø–æ—Å–ª–µ 9 –¥–µ–∫–∞–±—Ä—è
fetch('https://seller-analytics-api.wildberries.ru/api/analytics/v3/sales-funnel/products/history', {
  body: JSON.stringify({
    nmIds: [nmId],
    period: {
      start: "2025-10-29",
      end: "2025-11-04"
    }
  })
})
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ v3:**
- ‚úÖ –ü—Ä–æ—â–µ —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç (–±–µ–∑ –≤—Ä–µ–º–µ–Ω–∏)
- ‚úÖ –ú–µ–Ω—å—à–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –¥–æ 365 –¥–Ω–µ–π (–≤–º–µ—Å—Ç–æ 120)
- ‚úÖ –ù–µ –±—É–¥–µ—Ç —É–¥–∞–ª—ë–Ω

#### 2. Grouped history (—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏)

**–ë—ã–ª–æ (v2, deprecated):**
```typescript
// ‚ùå –£–¥–∞–ª—è—Ç 9 –¥–µ–∫–∞–±—Ä—è
fetch('https://seller-analytics-api.wildberries.ru/api/v2/nm-report/grouped/history', {
  body: JSON.stringify({
    objectIDs: [subjectId],
    period: {
      begin: "2025-10-29",
      end: "2025-11-04"
    },
    timezone: 'Europe/Moscow',
    aggregationLevel: 'day'
  })
})
```

**–°—Ç–∞–ª–æ (v3, –∞–∫—Ç—É–∞–ª—å–Ω–æ):**
```typescript
// ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —Å–µ–π—á–∞—Å –∏ –ø–æ—Å–ª–µ 9 –¥–µ–∫–∞–±—Ä—è
fetch('https://seller-analytics-api.wildberries.ru/api/analytics/v3/sales-funnel/grouped/history', {
  body: JSON.stringify({
    subjectIds: [subjectId],
    period: {
      start: "2025-10-29",
      end: "2025-11-04"
    }
  })
})
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ v3:**
- ‚úÖ –ü—Ä–æ—â–µ API (–º–µ–Ω—å—à–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤)
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –¥–æ 365 –¥–Ω–µ–π
- ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç timezone –∏ aggregationLevel

## –°—Ä–∞–≤–Ω–µ–Ω–∏–µ v2 vs v3

| –ü–∞—Ä–∞–º–µ—Ç—Ä | v2 (deprecated) | v3 (–∞–∫—Ç—É–∞–ª—å–Ω–æ) |
|----------|-----------------|----------------|
| –≠–Ω–¥–ø–æ–∏–Ω—Ç | `/api/v2/nm-report/*` | `/api/analytics/v3/sales-funnel/*` |
| –§–æ—Ä–º–∞—Ç –¥–∞—Ç | `"YYYY-MM-DD HH:MM:SS"` | `"YYYY-MM-DD"` |
| –õ–∏–º–∏—Ç –ø–µ—Ä–∏–æ–¥–∞ | 120 –¥–Ω–µ–π | 365 –¥–Ω–µ–π |
| Timezone | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ | –ù–µ –Ω—É–∂–µ–Ω |
| aggregationLevel | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ | –ù–µ –Ω—É–∂–µ–Ω |
| page | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ | –ù–µ –Ω—É–∂–µ–Ω |
| –°—Ç–∞—Ç—É—Å | ‚ùå –£–¥–∞–ª—è—Ç 9 –¥–µ–∫ | ‚úÖ –ê–∫—Ç—É–∞–ª—å–Ω–æ |

## –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ v3

### 1. Products History (–ø–æ —Ç–æ–≤–∞—Ä—É)
```typescript
POST /api/analytics/v3/sales-funnel/products/history

Request:
{
  "nmIds": [493805274],
  "period": {
    "start": "2025-10-01",
    "end": "2025-10-31"
  }
}

Response:
{
  "data": {
    "history": [
      {
        "date": "2025-10-01",
        "openCount": 150,
        "addToCartCount": 25,
        "orderCount": 10,
        "buyoutCount": 8
      },
      // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –¥–Ω–∏
    ]
  }
}
```

### 2. Grouped History (–ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏)
```typescript
POST /api/analytics/v3/sales-funnel/grouped/history

Request:
{
  "subjectIds": [69],  // ID –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "–ü–ª–∞—Ç—å—è"
  "period": {
    "start": "2025-10-01",
    "end": "2025-10-31"
  }
}

Response:
{
  "data": {
    "history": [
      {
        "date": "2025-10-01",
        "openCount": 5000,
        "addToCartCount": 800,
        "orderCount": 400
      },
      // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –¥–Ω–∏
    ]
  }
}
```

### 3. Products Summary (–∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
```typescript
POST /api/analytics/v3/sales-funnel/products

Request:
{
  "selectedPeriod": {
    "start": "2025-10-01",
    "end": "2025-10-31"
  },
  "pastPeriod": {
    "start": "2025-09-01",
    "end": "2025-09-30"
  },
  "nmIds": [493805274]
}

Response:
{
  "data": {
    "products": [
      {
        "nmId": 493805274,
        "statistic": {
          "selected": {
            "openCount": 3000,
            "addToCartCount": 500,
            "orderCount": 200,
            "buyoutCount": 150
          },
          "past": {
            "openCount": 2500,
            "addToCartCount": 400,
            "orderCount": 150,
            "buyoutCount": 120
          }
        }
      }
    ]
  }
}
```

## –ß—Ç–æ –ù–ï –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

### –≠—Ç–∏ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π:

| –≠–Ω–¥–ø–æ–∏–Ω—Ç | –°—Ç–∞—Ç—É—Å | –¢—Ä–µ–±—É–µ—Ç Jam |
|----------|--------|-------------|
| `/api/v2/search-report/product/search-texts` | ‚úÖ –ê–∫—Ç—É–∞–ª—å–Ω–æ | –î–∞ (–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π) |
| `/api/v2/search-report/report` | ‚úÖ –ê–∫—Ç—É–∞–ª—å–Ω–æ | –î–∞ (–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π) |
| `/api/v1/supplier/sales` | ‚úÖ –ê–∫—Ç—É–∞–ª—å–Ω–æ | –ù–µ—Ç |
| `/adv/v0/normquery/stats` | ‚úÖ –ê–∫—Ç—É–∞–ª—å–Ω–æ | –ù–µ—Ç |
| `/adv/v1/promotion/adverts` | ‚úÖ –ê–∫—Ç—É–∞–ª—å–Ω–æ | –ù–µ—Ç |

## –û—à–∏–±–∫–∏ –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø—Ä–∞–≤–∏–ª–∏—Å—å

### –î–æ –º–∏–≥—Ä–∞—Ü–∏–∏:
```
‚ùå –î–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç: 503 "Service Unavailable"
‚ùå Grouped history: 400 {"error":"–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —Ç–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞","additionalErrors":[{"field":"request body: period.begin","description":"invalid value 2025-10-08, select a date no earlier than 2025-10-29"}]}
‚ùå –í–æ—Ä–æ–Ω–∫–∞: 400 {"detail":"code=400, message={Invalid request body validate: invalid start day: excess limit on days...}"}
```

### –ü–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏:
```
‚úÖ V3 Analytics (history): –ø—Ä–æ—Å–º–æ—Ç—Ä—ã=3031, –∑–∞–∫–∞–∑—ã=20, –¥–Ω–µ–π=7
‚úÖ V3 Analytics (grouped): –ø–æ–ª—É—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
‚úÖ –í–æ—Ä–æ–Ω–∫–∞: 7 –¥–Ω–µ–π
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –º–∏–≥—Ä–∞—Ü–∏–∏

### 1. –†–∞–±–æ—Ç–∞–µ—Ç –°–ï–ô–ß–ê–° –∏ –ø–æ—Å–ª–µ 9 –¥–µ–∫–∞–±—Ä—è
- v2 —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã —É–¥–∞–ª—è—Ç 9 –¥–µ–∫–∞–±—Ä—è
- v3 —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã ‚Äî –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ, –Ω–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã

### 2. –ë–æ–ª—å—à–µ –¥–∞–Ω–Ω—ã—Ö
- v2: –º–∞–∫—Å–∏–º—É–º 120 –¥–Ω–µ–π
- v3: –º–∞–∫—Å–∏–º—É–º 365 –¥–Ω–µ–π

### 3. –ü—Ä–æ—â–µ API
- –ú–µ–Ω—å—à–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
- –ü—Ä–æ—â–µ —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç
- –ù–µ –Ω—É–∂–Ω—ã timezone, aggregationLevel, page

### 4. –°—Ç–∞–±–∏–ª—å–Ω–µ–µ
- v3 ‚Äî –Ω–æ–≤–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ WB
- –ú–µ–Ω—å—à–µ 503/500 –æ—à–∏–±–æ–∫
- –õ—É—á—à–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

## –ß—Ç–æ –¥–µ–ª–∞—Ç—å –°–ï–ô–ß–ê–°

### ‚úÖ –ö–æ–¥ —É–∂–µ –æ–±–Ω–æ–≤–ª—ë–Ω
–í—Å–µ —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ v2 —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ v3:
- `v2/nm-report/detail` ‚Üí `v3/sales-funnel/products/history`
- `v2/nm-report/grouped/history` ‚Üí `v3/sales-funnel/grouped/history`

### ‚úÖ –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä
```bash
npm run dev
```

### ‚úÖ –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç
1. –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:3000/test-ai-optimization
2. –í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ "–£–º–Ω—ã–π –ø–æ–∏—Å–∫"

### ‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
–î–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
```
üìà V3 Analytics (history): –ø—Ä–æ—Å–º–æ—Ç—Ä—ã=..., –∑–∞–∫–∞–∑—ã=..., –¥–Ω–µ–π=7
üîÑ V3 Analytics: grouped funnel –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
üìä V3 Analytics (grouped): –ø–æ–ª—É—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
```

## –ß—Ç–æ –µ—â—ë –Ω—É–∂–Ω–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å?

### –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥—Ä—É–≥–∏–µ —Ñ–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞:

```bash
# –ü–æ–∏—Å–∫ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
grep -r "v2/nm-report" .
grep -r "nm-report/detail" .
grep -r "nm-report/grouped" .
```

–ï—Å–ª–∏ –Ω–∞–π–¥—ë—Ç–µ ‚Äî –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ v3 –∞–Ω–∞–ª–æ–≥–∏.

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è WB

- [V3 Sales Funnel API](https://dev.wildberries.ru/openapi/analytics#tag/Voronka-prodazh)
- [Release Notes (–º–∏–≥—Ä–∞—Ü–∏—è)](https://dev.wildberries.ru/release-notes?id=198)

## –†–µ–∑—é–º–µ

‚úÖ **–ú–∏–≥—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞**
- –í—Å–µ v2 —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ v3
- –ö–æ–¥ –≥–æ—Ç–æ–≤ –∫ 9 –¥–µ–∫–∞–±—Ä—è 2025
- –†–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–µ–µ –∏ –¥–∞—ë—Ç –±–æ–ª—å—à–µ –¥–∞–Ω–Ω—ã—Ö

‚úÖ **–ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å:**
- `v2/nm-report/detail` ‚Üí `v3/sales-funnel/products/history`
- `v2/nm-report/grouped/history` ‚Üí `v3/sales-funnel/grouped/history`
- –õ–∏–º–∏—Ç: 120 –¥–Ω–µ–π ‚Üí 365 –¥–Ω–µ–π
- –§–æ—Ä–º–∞—Ç –¥–∞—Ç: —Å –≤—Ä–µ–º–µ–Ω–µ–º ‚Üí –±–µ–∑ –≤—Ä–µ–º–µ–Ω–∏

‚úÖ **–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:**
1. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
2. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ `/test-ai-optimization`
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ v3 —Å–æ–æ–±—â–µ–Ω–∏–π
4. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –Ω–µ—Ç –æ—à–∏–±–æ–∫ 400/503 –æ—Ç v2 —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
