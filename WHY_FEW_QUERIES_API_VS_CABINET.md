# –ü–æ—á–µ–º—É –≤ API –º–µ–Ω—å—à–µ –∑–∞–ø—Ä–æ—Å–æ–≤ —á–µ–º –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ WB?

## –ü—Ä–æ–±–ª–µ–º–∞
–í –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ WB –≤—ã –≤–∏–¥–∏—Ç–µ **–º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤**, –∞ —á–µ—Ä–µ–∑ API –ø—Ä–∏—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ **2 –∑–∞–ø—Ä–æ—Å–∞**.

## –ü—Ä–∏—á–∏–Ω—ã —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è

### 1. –§–∏–ª—å—Ç—Ä topOrderBy (–ò–°–ü–†–ê–í–õ–ï–ù–û)
**–ë—ã–ª–æ:**
```typescript
topOrderBy: 'orders'  // –¢–æ–ª—å–∫–æ –∑–∞–ø—Ä–æ—Å—ã —Å –∑–∞–∫–∞–∑–∞–º–∏
```

**–°—Ç–∞–ª–æ:**
```typescript
topOrderBy: 'openCard'  // –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã —Å –ø–µ—Ä–µ—Ö–æ–¥–∞–º–∏ –≤ –∫–∞—Ä—Ç–æ—á–∫—É
```

**–û–±—ä—è—Å–Ω–µ–Ω–∏–µ:**
- `topOrderBy: 'orders'` ‚Äî WB –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∑–∞–ø—Ä–æ—Å—ã, –ø–æ –∫–æ—Ç–æ—Ä—ã–º –±—ã–ª–∏ **–∑–∞–∫–∞–∑—ã**
- `topOrderBy: 'openCard'` ‚Äî WB –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã, –ø–æ –∫–æ—Ç–æ—Ä—ã–º –±—ã–ª–∏ **–ø–µ—Ä–µ—Ö–æ–¥—ã –≤ –∫–∞—Ä—Ç–æ—á–∫—É**
- –í –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –í–°–ï –∑–∞–ø—Ä–æ—Å—ã (–¥–∞–∂–µ –ø—Ä–æ—Å—Ç–æ —Å –ø–æ–∫–∞–∑–∞–º–∏)

### 2. –ü–µ—Ä–∏–æ–¥: –Ω–µ–¥–µ–ª—è vs –≤–µ—Å—å –ø–µ—Ä–∏–æ–¥
**API –∑–∞–ø—Ä–æ—Å:**
- –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∑–∞ **1 –Ω–µ–¥–µ–ª—é** (7 –¥–Ω–µ–π)
- –ü–æ—Ç–æ–º —Å–æ–±–∏—Ä–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∑–∞ 24 –Ω–µ–¥–µ–ª–∏ (6 –º–µ—Å—è—Ü–µ–≤)

**–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç WB:**
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∑–∞ **–≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥** (–Ω–∞–ø—Ä–∏–º–µ—Ä, 30 –¥–Ω–µ–π –∏–ª–∏ 90 –¥–Ω–µ–π)
- –ê–≥—Ä–µ–≥–∏—Ä—É–µ—Ç –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∑–∞ –≤–µ—Å—å –ø–µ—Ä–∏–æ–¥

**–†–µ—à–µ–Ω–∏–µ:**
–°–∏—Å—Ç–µ–º–∞ —É–∂–µ —Å–æ–±–∏—Ä–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∑–∞ 24 –Ω–µ–¥–µ–ª–∏ –∏ –∞–≥—Ä–µ–≥–∏—Ä—É–µ—Ç –∏—Ö. –ü–æ—Å–ª–µ –ø–æ–ª–Ω–æ–≥–æ —Å–±–æ—Ä–∞ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∑–∞ 6 –º–µ—Å—è—Ü–µ–≤.

### 3. –õ–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–∞
**API:**
```typescript
limit: 100  // –ú–∞–∫—Å–∏–º—É–º 100 –∑–∞–ø—Ä–æ—Å–æ–≤ –∑–∞ –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å
```

**–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç:**
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –í–°–ï –∑–∞–ø—Ä–æ—Å—ã –±–µ–∑ –ª–∏–º–∏—Ç–∞
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–∞–≥–∏–Ω–∞—Ü–∏—é

**–†–µ—à–µ–Ω–∏–µ:**
–ï—Å–ª–∏ —É —Ç–æ–≤–∞—Ä–∞ >100 –∑–∞–ø—Ä–æ—Å–æ–≤ –∑–∞ –Ω–µ–¥–µ–ª—é, –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–∞–≥–∏–Ω–∞—Ü–∏—é (offset).

### 4. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏

**–ß—Ç–æ –±—ã–ª–æ:**
```typescript
{
  topOrderBy: 'orders',           // ‚ùå –¢–æ–ª—å–∫–æ —Å –∑–∞–∫–∞–∑–∞–º–∏
  orderBy: { 
    field: 'avgPosition',         // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –ø–æ–∑–∏—Ü–∏–∏
    mode: 'asc' 
  }
}
```

**–ß—Ç–æ —Å—Ç–∞–ª–æ:**
```typescript
{
  topOrderBy: 'openCard',         // ‚úÖ –í—Å–µ —Å –ø–µ—Ä–µ—Ö–æ–¥–∞–º–∏
  orderBy: { 
    field: 'openCard',            // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –ø–µ—Ä–µ—Ö–æ–¥–∞–º
    mode: 'desc'                  // –û—Ç –±–æ–ª—å—à–µ–≥–æ –∫ –º–µ–Ω—å—à–µ–º—É
  }
}
```

## –í–∞—Ä–∏–∞–Ω—Ç—ã topOrderBy

### 'openCard' (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø) ‚úÖ
–ó–∞–ø—Ä–æ—Å—ã —Å –Ω–∞–∏–±–æ–ª—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –≤ –∫–∞—Ä—Ç–æ—á–∫—É.
**–ü–ª—é—Å—ã:**
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –í–°–ï –∑–∞–ø—Ä–æ—Å—ã —Å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é
- –í–∏–¥–Ω—ã –¥–∞–∂–µ –∑–∞–ø—Ä–æ—Å—ã –±–µ–∑ –∑–∞–∫–∞–∑–æ–≤
- –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç–æ–º—É, —á—Ç–æ –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ

### 'orders' (–±—ã–ª–æ)
–ó–∞–ø—Ä–æ—Å—ã —Å –Ω–∞–∏–±–æ–ª—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –∑–∞–∫–∞–∑–æ–≤.
**–ú–∏–Ω—É—Å—ã:**
- –ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –±–µ–∑ –∑–∞–∫–∞–∑–æ–≤
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ "–∫–æ–Ω–≤–µ—Ä—Å–∏–æ–Ω–Ω—ã–µ" –∑–∞–ø—Ä–æ—Å—ã
- –ú–µ–Ω—å—à–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞

### –î—Ä—É–≥–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã:
- `'addToCart'` ‚Äî –∑–∞–ø—Ä–æ—Å—ã —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –≤ –∫–æ—Ä–∑–∏–Ω—É
- `'openToCart'` ‚Äî –∫–æ–Ω–≤–µ—Ä—Å–∏—è –ø—Ä–æ—Å–º–æ—Ç—Ä ‚Üí –∫–æ—Ä–∑–∏–Ω–∞
- `'cartToOrder'` ‚Äî –∫–æ–Ω–≤–µ—Ä—Å–∏—è –∫–æ—Ä–∑–∏–Ω–∞ ‚Üí –∑–∞–∫–∞–∑

## –ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å –í–°–ï –∑–∞–ø—Ä–æ—Å—ã –∫–∞–∫ –≤ –∫–∞–±–∏–Ω–µ—Ç–µ

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å openCard (–°–î–ï–õ–ê–ù–û)
```typescript
topOrderBy: 'openCard'  // –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã —Å –ø–µ—Ä–µ—Ö–æ–¥–∞–º–∏
limit: 100              // –ú–∞–∫—Å–∏–º—É–º –∑–∞ –∑–∞–ø—Ä–æ—Å
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –î–æ–±–∞–≤–∏—Ç—å –ø–∞–≥–∏–Ω–∞—Ü–∏—é (–µ—Å–ª–∏ >100 –∑–∞–ø—Ä–æ—Å–æ–≤)
```typescript
// –ü–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å
{ limit: 100, offset: 0 }

// –í—Ç–æ—Ä–æ–π –∑–∞–ø—Ä–æ—Å
{ limit: 100, offset: 100 }

// –ò —Ç–∞–∫ –¥–∞–ª–µ–µ, –ø–æ–∫–∞ –Ω–µ –≤–µ—Ä–Ω—ë—Ç—Å—è –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ó–∞–ø—Ä–æ—Å–∏—Ç—å –∑–∞ –±–æ–ª—å—à–∏–π –ø–µ—Ä–∏–æ–¥
–í–º–µ—Å—Ç–æ –Ω–µ–¥–µ–ª–∏ –∑–∞–ø—Ä–æ—Å–∏—Ç—å –∑–∞ –º–µ—Å—è—Ü:
```typescript
currentPeriod: { 
  start: '2025-10-05',  // 30 –¥–Ω–µ–π –Ω–∞–∑–∞–¥
  end: '2025-11-04'     // —Å–µ–≥–æ–¥–Ω—è
}
```

**–ù–æ:** API –æ–≥—Ä–∞–Ω–∏—á–µ–Ω 90 –¥–Ω—è–º–∏ –¥–ª—è Search Report.

## –°—Ä–∞–≤–Ω–µ–Ω–∏–µ: –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç vs API

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç | API (–±—ã–ª–æ) | API (—Å—Ç–∞–ª–æ) |
|----------|----------------|------------|-------------|
| –ü–µ—Ä–∏–æ–¥ | –õ—é–±–æ–π (–≤—ã–±–æ—Ä) | 7 –¥–Ω–µ–π √ó 24 –Ω–µ–¥–µ–ª–∏ | 7 –¥–Ω–µ–π √ó 24 –Ω–µ–¥–µ–ª–∏ |
| –§–∏–ª—å—Ç—Ä | –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã | –¢–æ–ª—å–∫–æ —Å –∑–∞–∫–∞–∑–∞–º–∏ ‚ùå | –í—Å–µ —Å –ø–µ—Ä–µ—Ö–æ–¥–∞–º–∏ ‚úÖ |
| –õ–∏–º–∏—Ç | –ë–µ–∑ –ª–∏–º–∏—Ç–∞ | 100 –∑–∞ –∑–∞–ø—Ä–æ—Å | 100 –∑–∞ –∑–∞–ø—Ä–æ—Å |
| –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ | –ü–æ –ø–µ—Ä–µ—Ö–æ–¥–∞–º | –ü–æ –ø–æ–∑–∏—Ü–∏–∏ | –ü–æ –ø–µ—Ä–µ—Ö–æ–¥–∞–º |

## –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å –≤ –∫–æ–¥–µ

### –î–æ:
```typescript
body: JSON.stringify({
  currentPeriod: { start: startDate, end: endDate },
  nmIds: [nmId],
  limit: 100,
  topOrderBy: 'orders',              // ‚ùå –¢–æ–ª—å–∫–æ —Å –∑–∞–∫–∞–∑–∞–º–∏
  orderBy: { 
    field: 'avgPosition', 
    mode: 'asc' 
  }
})
```

### –ü–æ—Å–ª–µ:
```typescript
body: JSON.stringify({
  currentPeriod: { start: startDate, end: endDate },
  nmIds: [nmId],
  limit: 100,
  topOrderBy: 'openCard',            // ‚úÖ –í—Å–µ —Å –ø–µ—Ä–µ—Ö–æ–¥–∞–º–∏
  orderBy: { 
    field: 'openCard',               // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏
    mode: 'desc' 
  }
})
```

## –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

### –ë—ã–ª–æ:
```
üîç –ü–æ–∏—Å–∫–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã (product/search-texts): 2
```
–¢–æ–ª—å–∫–æ –∑–∞–ø—Ä–æ—Å—ã —Å –∑–∞–∫–∞–∑–∞–º–∏.

### –°—Ç–∞–Ω–µ—Ç:
```
üîç –ü–æ–∏—Å–∫–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã (product/search-texts): 15-50
```
–í—Å–µ –∑–∞–ø—Ä–æ—Å—ã —Å –ø–µ—Ä–µ—Ö–æ–¥–∞–º–∏ –≤ –∫–∞—Ä—Ç–æ—á–∫—É (–∫–∞–∫ –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ).

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: –ê–≥—Ä–µ–≥–∞—Ü–∏—è –∑–∞ 6 –º–µ—Å—è—Ü–µ–≤

–°–∏—Å—Ç–µ–º–∞ —Å–æ–±–∏—Ä–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∑–∞ 24 –Ω–µ–¥–µ–ª–∏ –∏ **–æ–±—ä–µ–¥–∏–Ω—è–µ—Ç** –≤—Å–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã:

```typescript
// –ù–µ–¥–µ–ª—è 1: ["–∑–∞–ø—Ä–æ—Å –ê", "–∑–∞–ø—Ä–æ—Å –ë"]
// –ù–µ–¥–µ–ª—è 2: ["–∑–∞–ø—Ä–æ—Å –ë", "–∑–∞–ø—Ä–æ—Å –í"]
// –ù–µ–¥–µ–ª—è 3: ["–∑–∞–ø—Ä–æ—Å –ê", "–∑–∞–ø—Ä–æ—Å –ì"]
// ...
// –ò—Ç–æ–≥–æ: ["–∑–∞–ø—Ä–æ—Å –ê", "–∑–∞–ø—Ä–æ—Å –ë", "–∑–∞–ø—Ä–æ—Å –í", "–∑–∞–ø—Ä–æ—Å –ì", ...]
```

–ü–æ—Å–ª–µ –ø–æ–ª–Ω–æ–≥–æ —Å–±–æ—Ä–∞ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ **–≤—Å–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∑–∞ 6 –º–µ—Å—è—Ü–µ–≤**.

## –ß—Ç–æ –¥–µ–ª–∞—Ç—å —Å–µ–π—á–∞—Å

1. ‚úÖ **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä** (`npm run dev`)
2. ‚úÖ **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç** –Ω–∞ `/test-ai-optimization`
3. ‚úÖ **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏** ‚Äî –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –±–æ–ª—å—à–µ –∑–∞–ø—Ä–æ—Å–æ–≤

## –ï—Å–ª–∏ –≤—Å—ë —Ä–∞–≤–Ω–æ –º–∞–ª–æ –∑–∞–ø—Ä–æ—Å–æ–≤

### –ü—Ä–æ–≤–µ—Ä–∫–∞ 1: –ü–µ—Ä–∏–æ–¥ –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ
–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ –≤—ã–±—Ä–∞–Ω **—Ç–æ—Ç –∂–µ –ø–µ—Ä–∏–æ–¥**, —á—Ç–æ –∏ –≤ API (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π).

### –ü—Ä–æ–≤–µ—Ä–∫–∞ 2: –§–∏–ª—å—Ç—Ä—ã –≤ –∫–∞–±–∏–Ω–µ—Ç–µ
–í –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ –º–æ–≥—É—Ç –±—ã—Ç—å –≤–∫–ª—é—á–µ–Ω—ã —Ñ–∏–ª—å—Ç—Ä—ã:
- "–í—Å–µ –∑–∞–ø—Ä–æ—Å—ã" vs "–¢–æ–ª—å–∫–æ —Å –∑–∞–∫–∞–∑–∞–º–∏"
- "–í—Å–µ –ø–æ–∑–∏—Ü–∏–∏" vs "–¢–æ–ø-100"

### –ü—Ä–æ–≤–µ—Ä–∫–∞ 3: –î–æ–±–∞–≤–∏—Ç—å –ø–∞–≥–∏–Ω–∞—Ü–∏—é
–ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ >100, –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Ü–∏–∫–ª —Å offset:
```typescript
let allItems = [];
let offset = 0;
while (true) {
  const resp = await fetch(..., {
    body: JSON.stringify({ ..., limit: 100, offset })
  });
  const data = await resp.json();
  const items = data.data?.items || [];
  if (items.length === 0) break;
  allItems.push(...items);
  offset += 100;
}
```

## –†–µ–∑—é–º–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

‚úÖ **topOrderBy: 'orders' ‚Üí 'openCard'** ‚Äî —Ç–µ–ø–µ—Ä—å –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã —Å –ø–µ—Ä–µ—Ö–æ–¥–∞–º–∏
‚úÖ **orderBy: avgPosition ‚Üí openCard** ‚Äî —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏
‚úÖ **limit: 100** ‚Äî –º–∞–∫—Å–∏–º—É–º –∑–∞–ø—Ä–æ—Å–æ–≤ –∑–∞ –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å
‚úÖ **–°–±–æ—Ä –∑–∞ 24 –Ω–µ–¥–µ–ª–∏** ‚Äî –∞–≥—Ä–µ–≥–∞—Ü–∏—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∑–∞ 6 –º–µ—Å—è—Ü–µ–≤

**–°–ª–µ–¥—É—é—â–∏–π –∑–∞–ø—É—Å–∫ –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å –Ω–∞–º–Ω–æ–≥–æ –±–æ–ª—å—à–µ –∑–∞–ø—Ä–æ—Å–æ–≤!**
